apiVersion: v1
items:
- apiVersion: v1
  kind: Pod
  metadata:
    annotations:
      kubectl.kubernetes.io/restartedAt: "2025-11-07T18:36:32+03:30"
    creationTimestamp: "2025-11-07T15:13:16Z"
    generateName: bitpin-app-b776cb8bc-
    generation: 1
    labels:
      app: bitpin-app
      pod-template-hash: b776cb8bc
    name: bitpin-app-b776cb8bc-g5f9h
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: apps/v1
      blockOwnerDeletion: true
      controller: true
      kind: ReplicaSet
      name: bitpin-app-b776cb8bc
      uid: 96ac6ddc-1ac5-472f-8a48-f3b1b915cea2
    resourceVersion: "48054"
    uid: e368e144-0f0f-49f8-b549-a78804e38af5
  spec:
    containers:
    - env:
      - name: DJANGO_SETTINGS_MODULE
        value: Exchange.settings
      - name: DATABASE_HOST
        valueFrom:
          secretKeyRef:
            key: host
            name: bitpin-cluster-app
      - name: DATABASE_PORT
        valueFrom:
          secretKeyRef:
            key: port
            name: bitpin-cluster-app
      - name: DATABASE_NAME
        valueFrom:
          secretKeyRef:
            key: dbname
            name: bitpin-cluster-app
      - name: DATABASE_USER
        valueFrom:
          secretKeyRef:
            key: user
            name: bitpin-cluster-app
      - name: DATABASE_PASSWORD
        valueFrom:
          secretKeyRef:
            key: password
            name: bitpin-cluster-app
      image: yasaman664/bitpin-task:latest
      imagePullPolicy: Always
      livenessProbe:
        failureThreshold: 3
        httpGet:
          path: /healthz/
          port: 8000
          scheme: HTTP
        initialDelaySeconds: 10
        periodSeconds: 20
        successThreshold: 1
        timeoutSeconds: 1
      name: bitpin-app
      ports:
      - containerPort: 8000
        protocol: TCP
      readinessProbe:
        failureThreshold: 3
        httpGet:
          path: /healthz/
          port: 8000
          scheme: HTTP
        initialDelaySeconds: 5
        periodSeconds: 10
        successThreshold: 1
        timeoutSeconds: 1
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /app/Exchange/static
        name: static-volume
      - mountPath: /app/Exchange/media
        name: media-volume
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-qjrkn
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: Always
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - emptyDir: {}
      name: static-volume
    - emptyDir: {}
      name: media-volume
    - name: kube-api-access-qjrkn
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-07T15:13:19Z"
      status: "True"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-07T15:13:16Z"
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-07T15:13:30Z"
      status: "True"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-07T15:13:30Z"
      status: "True"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-07T15:13:16Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://ee3d5159ef198f6fbe899404d11d50c5789dbb2d4b39989d4d5d81da7c7bdd4a
      image: docker.io/yasaman664/bitpin-task:latest
      imageID: docker.io/yasaman664/bitpin-task@sha256:ef7630128f3197f93734117677b4df02de784ffc3a28613f5f21e4f1ce3faeb6
      lastState: {}
      name: bitpin-app
      ready: true
      resources: {}
      restartCount: 0
      started: true
      state:
        running:
          startedAt: "2025-11-07T15:13:18Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /app/Exchange/static
        name: static-volume
      - mountPath: /app/Exchange/media
        name: media-volume
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-qjrkn
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Running
    podIP: 10.42.0.92
    podIPs:
    - ip: 10.42.0.92
    qosClass: BestEffort
    startTime: "2025-11-07T15:13:16Z"
- apiVersion: v1
  kind: Pod
  metadata:
    annotations:
      cnpg.io/nodeSerial: "1"
      cnpg.io/operatorVersion: 1.27.1
      cnpg.io/podEnvHash: 57b497f8fd
      cnpg.io/podSpec: '{"volumes":[{"name":"pgdata","persistentVolumeClaim":{"claimName":"bitpin-cluster-1"}},{"name":"scratch-data","emptyDir":{}},{"name":"shm","emptyDir":{"medium":"Memory"}}],"initContainers":[{"name":"bootstrap-controller","image":"ghcr.io/cloudnative-pg/cloudnative-pg:1.27.1","command":["/manager","bootstrap","/controller/manager","--log-level=info"],"resources":{},"volumeMounts":[{"name":"pgdata","mountPath":"/var/lib/postgresql/data"},{"name":"scratch-data","mountPath":"/run"},{"name":"scratch-data","mountPath":"/controller"},{"name":"shm","mountPath":"/dev/shm"}],"securityContext":{"capabilities":{"drop":["ALL"]},"privileged":false,"runAsNonRoot":true,"readOnlyRootFilesystem":true,"allowPrivilegeEscalation":false,"seccompProfile":{"type":"RuntimeDefault"}}}],"containers":[{"name":"postgres","image":"ghcr.io/cloudnative-pg/postgresql:15.3","command":["/controller/manager","instance","run","--status-port-tls","--log-level=info"],"ports":[{"name":"postgresql","containerPort":5432,"protocol":"TCP"},{"name":"metrics","containerPort":9187,"protocol":"TCP"},{"name":"status","containerPort":8000,"protocol":"TCP"}],"env":[{"name":"PGDATA","value":"/var/lib/postgresql/data/pgdata"},{"name":"POD_NAME","value":"bitpin-cluster-1"},{"name":"NAMESPACE","value":"bitpin-task"},{"name":"CLUSTER_NAME","value":"bitpin-cluster"},{"name":"PSQL_HISTORY","value":"/controller/tmp/.psql_history"},{"name":"PGPORT","value":"5432"},{"name":"PGHOST","value":"/controller/run"},{"name":"TMPDIR","value":"/controller/tmp"}],"resources":{},"volumeMounts":[{"name":"pgdata","mountPath":"/var/lib/postgresql/data"},{"name":"scratch-data","mountPath":"/run"},{"name":"scratch-data","mountPath":"/controller"},{"name":"shm","mountPath":"/dev/shm"}],"livenessProbe":{"httpGet":{"path":"/healthz","port":8000,"scheme":"HTTPS"},"timeoutSeconds":5,"periodSeconds":10},"readinessProbe":{"httpGet":{"path":"/readyz","port":8000,"scheme":"HTTPS"},"timeoutSeconds":5,"periodSeconds":10},"startupProbe":{"httpGet":{"path":"/startupz","port":8000,"scheme":"HTTPS"},"timeoutSeconds":5,"periodSeconds":10,"failureThreshold":360},"securityContext":{"capabilities":{"drop":["ALL"]},"privileged":false,"runAsNonRoot":true,"readOnlyRootFilesystem":true,"allowPrivilegeEscalation":false,"seccompProfile":{"type":"RuntimeDefault"}}}],"terminationGracePeriodSeconds":1800,"serviceAccountName":"bitpin-cluster","securityContext":{"runAsUser":26,"runAsGroup":26,"runAsNonRoot":true,"fsGroup":26,"seccompProfile":{"type":"RuntimeDefault"}},"hostname":"bitpin-cluster-1","affinity":{"podAntiAffinity":{"preferredDuringSchedulingIgnoredDuringExecution":[{"weight":100,"podAffinityTerm":{"labelSelector":{"matchExpressions":[{"key":"cnpg.io/cluster","operator":"In","values":["bitpin-cluster"]},{"key":"cnpg.io/podRole","operator":"In","values":["instance"]}]},"topologyKey":"kubernetes.io/hostname"}}]}}}'
    creationTimestamp: "2025-11-08T11:00:30Z"
    generation: 1
    labels:
      cnpg.io/cluster: bitpin-cluster
      cnpg.io/instanceName: bitpin-cluster-1
      cnpg.io/instanceRole: primary
      cnpg.io/podRole: instance
      role: primary
    name: bitpin-cluster-1
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: postgresql.cnpg.io/v1
      blockOwnerDeletion: true
      controller: true
      kind: Cluster
      name: bitpin-cluster
      uid: 1a43e070-4777-4a29-858a-c9313ba36c4a
    resourceVersion: "152973"
    uid: e17464ec-5e52-4df8-990d-f1a575213f05
  spec:
    affinity:
      podAntiAffinity:
        preferredDuringSchedulingIgnoredDuringExecution:
        - podAffinityTerm:
            labelSelector:
              matchExpressions:
              - key: cnpg.io/cluster
                operator: In
                values:
                - bitpin-cluster
              - key: cnpg.io/podRole
                operator: In
                values:
                - instance
            topologyKey: kubernetes.io/hostname
          weight: 100
    containers:
    - command:
      - /controller/manager
      - instance
      - run
      - --status-port-tls
      - --log-level=info
      env:
      - name: PGDATA
        value: /var/lib/postgresql/data/pgdata
      - name: POD_NAME
        value: bitpin-cluster-1
      - name: NAMESPACE
        value: bitpin-task
      - name: CLUSTER_NAME
        value: bitpin-cluster
      - name: PSQL_HISTORY
        value: /controller/tmp/.psql_history
      - name: PGPORT
        value: "5432"
      - name: PGHOST
        value: /controller/run
      - name: TMPDIR
        value: /controller/tmp
      image: ghcr.io/cloudnative-pg/postgresql:15.3
      imagePullPolicy: IfNotPresent
      livenessProbe:
        failureThreshold: 3
        httpGet:
          path: /healthz
          port: 8000
          scheme: HTTPS
        periodSeconds: 10
        successThreshold: 1
        timeoutSeconds: 5
      name: postgres
      ports:
      - containerPort: 5432
        name: postgresql
        protocol: TCP
      - containerPort: 9187
        name: metrics
        protocol: TCP
      - containerPort: 8000
        name: status
        protocol: TCP
      readinessProbe:
        failureThreshold: 3
        httpGet:
          path: /readyz
          port: 8000
          scheme: HTTPS
        periodSeconds: 10
        successThreshold: 1
        timeoutSeconds: 5
      resources: {}
      securityContext:
        allowPrivilegeEscalation: false
        capabilities:
          drop:
          - ALL
        privileged: false
        readOnlyRootFilesystem: true
        runAsNonRoot: true
        seccompProfile:
          type: RuntimeDefault
      startupProbe:
        failureThreshold: 360
        httpGet:
          path: /startupz
          port: 8000
          scheme: HTTPS
        periodSeconds: 10
        successThreshold: 1
        timeoutSeconds: 5
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /var/lib/postgresql/data
        name: pgdata
      - mountPath: /run
        name: scratch-data
      - mountPath: /controller
        name: scratch-data
      - mountPath: /dev/shm
        name: shm
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-wkdlx
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    hostname: bitpin-cluster-1
    initContainers:
    - command:
      - /manager
      - bootstrap
      - /controller/manager
      - --log-level=info
      image: ghcr.io/cloudnative-pg/cloudnative-pg:1.27.1
      imagePullPolicy: IfNotPresent
      name: bootstrap-controller
      resources: {}
      securityContext:
        allowPrivilegeEscalation: false
        capabilities:
          drop:
          - ALL
        privileged: false
        readOnlyRootFilesystem: true
        runAsNonRoot: true
        seccompProfile:
          type: RuntimeDefault
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /var/lib/postgresql/data
        name: pgdata
      - mountPath: /run
        name: scratch-data
      - mountPath: /controller
        name: scratch-data
      - mountPath: /dev/shm
        name: shm
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-wkdlx
        readOnly: true
    nodeName: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: Always
    schedulerName: default-scheduler
    securityContext:
      fsGroup: 26
      runAsGroup: 26
      runAsNonRoot: true
      runAsUser: 26
      seccompProfile:
        type: RuntimeDefault
    serviceAccount: bitpin-cluster
    serviceAccountName: bitpin-cluster
    terminationGracePeriodSeconds: 1800
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - name: pgdata
      persistentVolumeClaim:
        claimName: bitpin-cluster-1
    - emptyDir: {}
      name: scratch-data
    - emptyDir:
        medium: Memory
      name: shm
    - name: kube-api-access-wkdlx
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:05:50Z"
      status: "True"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:05:51Z"
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:06:19Z"
      status: "True"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:06:19Z"
      status: "True"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:05:48Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://4d403daddeaa7c491b42dd4aa43f57ac01218dded45b809bf2a42ac980c2c8cf
      image: ghcr.io/cloudnative-pg/postgresql:15.3
      imageID: ghcr.io/cloudnative-pg/postgresql@sha256:a77cf81d90ad26148d795a8ba2a880715d11b30ec45dd15aa34ae8d7cc4dc2dd
      lastState: {}
      name: postgres
      ready: true
      resources: {}
      restartCount: 0
      started: true
      state:
        running:
          startedAt: "2025-11-08T11:06:11Z"
      user:
        linux:
          gid: 26
          supplementalGroups:
          - 26
          - 101
          uid: 26
      volumeMounts:
      - mountPath: /var/lib/postgresql/data
        name: pgdata
      - mountPath: /run
        name: scratch-data
      - mountPath: /controller
        name: scratch-data
      - mountPath: /dev/shm
        name: shm
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-wkdlx
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    initContainerStatuses:
    - containerID: containerd://220b85806df365d64a283316e7fcd8978b0963c4c3a8d76270499ba7974faf67
      image: ghcr.io/cloudnative-pg/cloudnative-pg:1.27.1
      imageID: ghcr.io/cloudnative-pg/cloudnative-pg@sha256:cfa380de51377fa61122d43c1214d43d3268c3c17da57612ee8fea1d46b61856
      lastState: {}
      name: bootstrap-controller
      ready: true
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://220b85806df365d64a283316e7fcd8978b0963c4c3a8d76270499ba7974faf67
          exitCode: 0
          finishedAt: "2025-11-08T11:05:51Z"
          reason: Completed
          startedAt: "2025-11-08T11:05:49Z"
      user:
        linux:
          gid: 26
          supplementalGroups:
          - 26
          uid: 26
      volumeMounts:
      - mountPath: /var/lib/postgresql/data
        name: pgdata
      - mountPath: /run
        name: scratch-data
      - mountPath: /controller
        name: scratch-data
      - mountPath: /dev/shm
        name: shm
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-wkdlx
        readOnly: true
        recursiveReadOnly: Disabled
    phase: Running
    podIP: 10.42.0.209
    podIPs:
    - ip: 10.42.0.209
    qosClass: BestEffort
    startTime: "2025-11-08T11:05:49Z"
- apiVersion: v1
  kind: Pod
  metadata:
    annotations:
      cnpg.io/nodeSerial: "2"
      cnpg.io/operatorVersion: 1.27.1
      cnpg.io/podEnvHash: 7d8bd9b7c5
      cnpg.io/podSpec: '{"volumes":[{"name":"pgdata","persistentVolumeClaim":{"claimName":"bitpin-cluster-2"}},{"name":"scratch-data","emptyDir":{}},{"name":"shm","emptyDir":{"medium":"Memory"}}],"initContainers":[{"name":"bootstrap-controller","image":"ghcr.io/cloudnative-pg/cloudnative-pg:1.27.1","command":["/manager","bootstrap","/controller/manager","--log-level=info"],"resources":{},"volumeMounts":[{"name":"pgdata","mountPath":"/var/lib/postgresql/data"},{"name":"scratch-data","mountPath":"/run"},{"name":"scratch-data","mountPath":"/controller"},{"name":"shm","mountPath":"/dev/shm"}],"securityContext":{"capabilities":{"drop":["ALL"]},"privileged":false,"runAsNonRoot":true,"readOnlyRootFilesystem":true,"allowPrivilegeEscalation":false,"seccompProfile":{"type":"RuntimeDefault"}}}],"containers":[{"name":"postgres","image":"ghcr.io/cloudnative-pg/postgresql:15.3","command":["/controller/manager","instance","run","--status-port-tls","--log-level=info"],"ports":[{"name":"postgresql","containerPort":5432,"protocol":"TCP"},{"name":"metrics","containerPort":9187,"protocol":"TCP"},{"name":"status","containerPort":8000,"protocol":"TCP"}],"env":[{"name":"PGDATA","value":"/var/lib/postgresql/data/pgdata"},{"name":"POD_NAME","value":"bitpin-cluster-2"},{"name":"NAMESPACE","value":"bitpin-task"},{"name":"CLUSTER_NAME","value":"bitpin-cluster"},{"name":"PSQL_HISTORY","value":"/controller/tmp/.psql_history"},{"name":"PGPORT","value":"5432"},{"name":"PGHOST","value":"/controller/run"},{"name":"TMPDIR","value":"/controller/tmp"}],"resources":{},"volumeMounts":[{"name":"pgdata","mountPath":"/var/lib/postgresql/data"},{"name":"scratch-data","mountPath":"/run"},{"name":"scratch-data","mountPath":"/controller"},{"name":"shm","mountPath":"/dev/shm"}],"livenessProbe":{"httpGet":{"path":"/healthz","port":8000,"scheme":"HTTPS"},"timeoutSeconds":5,"periodSeconds":10},"readinessProbe":{"httpGet":{"path":"/readyz","port":8000,"scheme":"HTTPS"},"timeoutSeconds":5,"periodSeconds":10},"startupProbe":{"httpGet":{"path":"/startupz","port":8000,"scheme":"HTTPS"},"timeoutSeconds":5,"periodSeconds":10,"failureThreshold":360},"securityContext":{"capabilities":{"drop":["ALL"]},"privileged":false,"runAsNonRoot":true,"readOnlyRootFilesystem":true,"allowPrivilegeEscalation":false,"seccompProfile":{"type":"RuntimeDefault"}}}],"terminationGracePeriodSeconds":1800,"serviceAccountName":"bitpin-cluster","securityContext":{"runAsUser":26,"runAsGroup":26,"runAsNonRoot":true,"fsGroup":26,"seccompProfile":{"type":"RuntimeDefault"}},"hostname":"bitpin-cluster-2","affinity":{"podAntiAffinity":{"preferredDuringSchedulingIgnoredDuringExecution":[{"weight":100,"podAffinityTerm":{"labelSelector":{"matchExpressions":[{"key":"cnpg.io/cluster","operator":"In","values":["bitpin-cluster"]},{"key":"cnpg.io/podRole","operator":"In","values":["instance"]}]},"topologyKey":"kubernetes.io/hostname"}}]}}}'
    creationTimestamp: "2025-11-08T11:06:20Z"
    generation: 1
    labels:
      cnpg.io/cluster: bitpin-cluster
      cnpg.io/instanceName: bitpin-cluster-2
      cnpg.io/instanceRole: replica
      cnpg.io/podRole: instance
      role: replica
    name: bitpin-cluster-2
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: postgresql.cnpg.io/v1
      blockOwnerDeletion: true
      controller: true
      kind: Cluster
      name: bitpin-cluster
      uid: 1a43e070-4777-4a29-858a-c9313ba36c4a
    resourceVersion: "153030"
    uid: 15b5c9f2-5001-47f3-b682-ef7d3a5e9750
  spec:
    affinity:
      podAntiAffinity:
        preferredDuringSchedulingIgnoredDuringExecution:
        - podAffinityTerm:
            labelSelector:
              matchExpressions:
              - key: cnpg.io/cluster
                operator: In
                values:
                - bitpin-cluster
              - key: cnpg.io/podRole
                operator: In
                values:
                - instance
            topologyKey: kubernetes.io/hostname
          weight: 100
    containers:
    - command:
      - /controller/manager
      - instance
      - run
      - --status-port-tls
      - --log-level=info
      env:
      - name: PGDATA
        value: /var/lib/postgresql/data/pgdata
      - name: POD_NAME
        value: bitpin-cluster-2
      - name: NAMESPACE
        value: bitpin-task
      - name: CLUSTER_NAME
        value: bitpin-cluster
      - name: PSQL_HISTORY
        value: /controller/tmp/.psql_history
      - name: PGPORT
        value: "5432"
      - name: PGHOST
        value: /controller/run
      - name: TMPDIR
        value: /controller/tmp
      image: ghcr.io/cloudnative-pg/postgresql:15.3
      imagePullPolicy: IfNotPresent
      livenessProbe:
        failureThreshold: 3
        httpGet:
          path: /healthz
          port: 8000
          scheme: HTTPS
        periodSeconds: 10
        successThreshold: 1
        timeoutSeconds: 5
      name: postgres
      ports:
      - containerPort: 5432
        name: postgresql
        protocol: TCP
      - containerPort: 9187
        name: metrics
        protocol: TCP
      - containerPort: 8000
        name: status
        protocol: TCP
      readinessProbe:
        failureThreshold: 3
        httpGet:
          path: /readyz
          port: 8000
          scheme: HTTPS
        periodSeconds: 10
        successThreshold: 1
        timeoutSeconds: 5
      resources: {}
      securityContext:
        allowPrivilegeEscalation: false
        capabilities:
          drop:
          - ALL
        privileged: false
        readOnlyRootFilesystem: true
        runAsNonRoot: true
        seccompProfile:
          type: RuntimeDefault
      startupProbe:
        failureThreshold: 360
        httpGet:
          path: /startupz
          port: 8000
          scheme: HTTPS
        periodSeconds: 10
        successThreshold: 1
        timeoutSeconds: 5
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /var/lib/postgresql/data
        name: pgdata
      - mountPath: /run
        name: scratch-data
      - mountPath: /controller
        name: scratch-data
      - mountPath: /dev/shm
        name: shm
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-sq95c
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    hostname: bitpin-cluster-2
    initContainers:
    - command:
      - /manager
      - bootstrap
      - /controller/manager
      - --log-level=info
      image: ghcr.io/cloudnative-pg/cloudnative-pg:1.27.1
      imagePullPolicy: IfNotPresent
      name: bootstrap-controller
      resources: {}
      securityContext:
        allowPrivilegeEscalation: false
        capabilities:
          drop:
          - ALL
        privileged: false
        readOnlyRootFilesystem: true
        runAsNonRoot: true
        seccompProfile:
          type: RuntimeDefault
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /var/lib/postgresql/data
        name: pgdata
      - mountPath: /run
        name: scratch-data
      - mountPath: /controller
        name: scratch-data
      - mountPath: /dev/shm
        name: shm
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-sq95c
        readOnly: true
    nodeName: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: Always
    schedulerName: default-scheduler
    securityContext:
      fsGroup: 26
      runAsGroup: 26
      runAsNonRoot: true
      runAsUser: 26
      seccompProfile:
        type: RuntimeDefault
    serviceAccount: bitpin-cluster
    serviceAccountName: bitpin-cluster
    terminationGracePeriodSeconds: 1800
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - name: pgdata
      persistentVolumeClaim:
        claimName: bitpin-cluster-2
    - emptyDir: {}
      name: scratch-data
    - emptyDir:
        medium: Memory
      name: shm
    - name: kube-api-access-sq95c
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:06:21Z"
      status: "True"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:06:23Z"
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:06:32Z"
      status: "True"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:06:32Z"
      status: "True"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:06:20Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://e23764f996551635d7d577f93a9009b2c3580fddf37edb5907540230f2d3be06
      image: ghcr.io/cloudnative-pg/postgresql:15.3
      imageID: ghcr.io/cloudnative-pg/postgresql@sha256:a77cf81d90ad26148d795a8ba2a880715d11b30ec45dd15aa34ae8d7cc4dc2dd
      lastState: {}
      name: postgres
      ready: true
      resources: {}
      restartCount: 0
      started: true
      state:
        running:
          startedAt: "2025-11-08T11:06:24Z"
      user:
        linux:
          gid: 26
          supplementalGroups:
          - 26
          - 101
          uid: 26
      volumeMounts:
      - mountPath: /var/lib/postgresql/data
        name: pgdata
      - mountPath: /run
        name: scratch-data
      - mountPath: /controller
        name: scratch-data
      - mountPath: /dev/shm
        name: shm
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-sq95c
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    initContainerStatuses:
    - containerID: containerd://a328e1375ae2216db53a61c7aa420c8ce9f53031af9b13e4d81038a4f7b8a727
      image: ghcr.io/cloudnative-pg/cloudnative-pg:1.27.1
      imageID: ghcr.io/cloudnative-pg/cloudnative-pg@sha256:cfa380de51377fa61122d43c1214d43d3268c3c17da57612ee8fea1d46b61856
      lastState: {}
      name: bootstrap-controller
      ready: true
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://a328e1375ae2216db53a61c7aa420c8ce9f53031af9b13e4d81038a4f7b8a727
          exitCode: 0
          finishedAt: "2025-11-08T11:06:23Z"
          reason: Completed
          startedAt: "2025-11-08T11:06:21Z"
      user:
        linux:
          gid: 26
          supplementalGroups:
          - 26
          uid: 26
      volumeMounts:
      - mountPath: /var/lib/postgresql/data
        name: pgdata
      - mountPath: /run
        name: scratch-data
      - mountPath: /controller
        name: scratch-data
      - mountPath: /dev/shm
        name: shm
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-sq95c
        readOnly: true
        recursiveReadOnly: Disabled
    phase: Running
    podIP: 10.42.0.210
    podIPs:
    - ip: 10.42.0.210
    qosClass: BestEffort
    startTime: "2025-11-08T11:06:20Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T08:02:45Z"
    generation: 1
    labels:
      run: bitpin-full-backup-manual-test
    name: bitpin-full-backup-manual-test
    namespace: bitpin-task
    resourceVersion: "135508"
    uid: 81fc395b-7958-48a0-9141-4376d783d710
  spec:
    containers:
    - args:
      - bash
      - -c
      - mkdir -p /mnt/backups/full; chmod 777 /mnt/backups/full; pg_dump -h $DB_HOST
        -p $DB_PORT -U $DB_USER -d $DB_NAME | gzip > /mnt/backups/full/bitpin-backup-$(date
        +%F-%H%M%S).sql.gz
      env:
      - name: PGPASSWORD
        value: jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s
      - name: DB_HOST
        value: bitpin-cluster-rw
      - name: DB_PORT
        value: "5432"
      - name: DB_NAME
        value: bitpin_db
      - name: DB_USER
        value: bitpin_user
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: bitpin-full-backup-manual-test
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-mmmb2
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: Never
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - name: kube-api-access-mmmb2
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:02:52Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:02:45Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:02:45Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:02:45Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:02:45Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://6fadde83eaedea742dab7684f222b7f35d1227a949c1a7ef0ca604085fcb5f75
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: bitpin-full-backup-manual-test
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://6fadde83eaedea742dab7684f222b7f35d1227a949c1a7ef0ca604085fcb5f75
          exitCode: 0
          finishedAt: "2025-11-08T08:02:50Z"
          reason: Completed
          startedAt: "2025-11-08T08:02:50Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-mmmb2
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.168
    podIPs:
    - ip: 10.42.0.168
    qosClass: BestEffort
    startTime: "2025-11-08T08:02:45Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T08:45:00Z"
    generateName: bitpin-incremental-backup-29376525-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 75a97203-98ac-427e-bef8-c0678a4cb1d3
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376525
      controller-uid: 75a97203-98ac-427e-bef8-c0678a4cb1d3
      job-name: bitpin-incremental-backup-29376525
    name: bitpin-incremental-backup-29376525-jr4gg
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376525
      uid: 75a97203-98ac-427e-bef8-c0678a4cb1d3
    resourceVersion: "139566"
    uid: 353a0970-468e-467a-bc22-4bf732e07c68
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-2x8dn
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-2x8dn
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:45:03Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:45:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:45:02Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:45:02Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:45:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://5d5db26464a91b2ce14263d1fa59e7ab18f89efdf90b747ec8c214c5ce92f03e
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://5d5db26464a91b2ce14263d1fa59e7ab18f89efdf90b747ec8c214c5ce92f03e
          exitCode: 0
          finishedAt: "2025-11-08T08:45:01Z"
          reason: Completed
          startedAt: "2025-11-08T08:45:00Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-2x8dn
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.184
    podIPs:
    - ip: 10.42.0.184
    qosClass: BestEffort
    startTime: "2025-11-08T08:45:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T09:00:00Z"
    generateName: bitpin-incremental-backup-29376540-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 65527515-8d2b-47a4-ba3d-1059fae86805
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376540
      controller-uid: 65527515-8d2b-47a4-ba3d-1059fae86805
      job-name: bitpin-incremental-backup-29376540
    name: bitpin-incremental-backup-29376540-5shrp
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376540
      uid: 65527515-8d2b-47a4-ba3d-1059fae86805
    resourceVersion: "140988"
    uid: 0dc3fada-ffb0-493f-86bb-4ce859f6fb97
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-gvf9b
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-gvf9b
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:00:11Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:00:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:00:00Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:00:00Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:00:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://d231be9e06889b8cf4bb7eb74b92fd6b1cca3cc857101fa082aebda0a45fb02c
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://d231be9e06889b8cf4bb7eb74b92fd6b1cca3cc857101fa082aebda0a45fb02c
          exitCode: 0
          finishedAt: "2025-11-08T09:00:09Z"
          reason: Completed
          startedAt: "2025-11-08T09:00:09Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-gvf9b
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.187
    podIPs:
    - ip: 10.42.0.187
    qosClass: BestEffort
    startTime: "2025-11-08T09:00:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T09:15:00Z"
    generateName: bitpin-incremental-backup-29376555-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 45a907f8-57f3-4bea-97f6-c3ec189aa07f
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376555
      controller-uid: 45a907f8-57f3-4bea-97f6-c3ec189aa07f
      job-name: bitpin-incremental-backup-29376555
    name: bitpin-incremental-backup-29376555-5gvfc
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376555
      uid: 45a907f8-57f3-4bea-97f6-c3ec189aa07f
    resourceVersion: "142363"
    uid: 7270d16b-ca88-4a48-8141-385370017f85
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-nzrn6
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-nzrn6
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:15:06Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:15:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:15:00Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:15:00Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:15:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://dab91855158c83f735067d104a95ad50a9903d4faf1970c607126bdebe19dfd9
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://dab91855158c83f735067d104a95ad50a9903d4faf1970c607126bdebe19dfd9
          exitCode: 0
          finishedAt: "2025-11-08T09:15:04Z"
          reason: Completed
          startedAt: "2025-11-08T09:15:04Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-nzrn6
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.189
    podIPs:
    - ip: 10.42.0.189
    qosClass: BestEffort
    startTime: "2025-11-08T09:15:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T09:30:00Z"
    generateName: bitpin-incremental-backup-29376570-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 0d8a6c73-49d4-4d3f-8ef5-e2c3ee5aa26b
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376570
      controller-uid: 0d8a6c73-49d4-4d3f-8ef5-e2c3ee5aa26b
      job-name: bitpin-incremental-backup-29376570
    name: bitpin-incremental-backup-29376570-b8dfp
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376570
      uid: 0d8a6c73-49d4-4d3f-8ef5-e2c3ee5aa26b
    resourceVersion: "143726"
    uid: a4ffd5a2-ef75-4500-8153-1d380af432fc
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-r9s4g
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-r9s4g
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:30:06Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:30:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:30:00Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:30:00Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:30:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://e811696adc21becb4493c7ddf5c10ce46f3f6f4e03edd995a6004085b3bcc503
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://e811696adc21becb4493c7ddf5c10ce46f3f6f4e03edd995a6004085b3bcc503
          exitCode: 0
          finishedAt: "2025-11-08T09:30:05Z"
          reason: Completed
          startedAt: "2025-11-08T09:30:05Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-r9s4g
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.191
    podIPs:
    - ip: 10.42.0.191
    qosClass: BestEffort
    startTime: "2025-11-08T09:30:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T09:45:00Z"
    generateName: bitpin-incremental-backup-29376585-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 9b01986a-8ade-4768-b820-ef4a1d3384dc
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376585
      controller-uid: 9b01986a-8ade-4768-b820-ef4a1d3384dc
      job-name: bitpin-incremental-backup-29376585
    name: bitpin-incremental-backup-29376585-phjmb
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376585
      uid: 9b01986a-8ade-4768-b820-ef4a1d3384dc
    resourceVersion: "145094"
    uid: 4399f529-2247-4451-b711-8099ef589c3a
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-m669b
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-m669b
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:45:08Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:45:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:45:07Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:45:07Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T09:45:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://8dec3743f07722774484985c0342ec07ddc91ee911789b8838df73d4565b7db4
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://8dec3743f07722774484985c0342ec07ddc91ee911789b8838df73d4565b7db4
          exitCode: 0
          finishedAt: "2025-11-08T09:45:06Z"
          reason: Completed
          startedAt: "2025-11-08T09:45:04Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-m669b
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.193
    podIPs:
    - ip: 10.42.0.193
    qosClass: BestEffort
    startTime: "2025-11-08T09:45:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T10:00:00Z"
    generateName: bitpin-incremental-backup-29376600-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 0e92b704-4859-4127-bde7-8effe5fa8984
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376600
      controller-uid: 0e92b704-4859-4127-bde7-8effe5fa8984
      job-name: bitpin-incremental-backup-29376600
    name: bitpin-incremental-backup-29376600-ngs2v
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376600
      uid: 0e92b704-4859-4127-bde7-8effe5fa8984
    resourceVersion: "146448"
    uid: 524d7990-295f-4ad3-8971-afb9fbd404a9
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-8jh7r
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-8jh7r
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:00:07Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:00:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:00:06Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:00:06Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:00:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://73f40e0e6f821bd1f8b6c3de72bcc6b9f9be08dde91df31f141b234bd4d9f641
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://73f40e0e6f821bd1f8b6c3de72bcc6b9f9be08dde91df31f141b234bd4d9f641
          exitCode: 0
          finishedAt: "2025-11-08T10:00:05Z"
          reason: Completed
          startedAt: "2025-11-08T10:00:05Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-8jh7r
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.196
    podIPs:
    - ip: 10.42.0.196
    qosClass: BestEffort
    startTime: "2025-11-08T10:00:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T10:15:00Z"
    generateName: bitpin-incremental-backup-29376615-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 581527bc-0b06-4f29-9e3e-ff7314f4a65b
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376615
      controller-uid: 581527bc-0b06-4f29-9e3e-ff7314f4a65b
      job-name: bitpin-incremental-backup-29376615
    name: bitpin-incremental-backup-29376615-w8wlk
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376615
      uid: 581527bc-0b06-4f29-9e3e-ff7314f4a65b
    resourceVersion: "147801"
    uid: 6d4683e6-3689-446a-8bca-a36c651893bc
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-z5ggt
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-z5ggt
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:15:07Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:15:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:15:06Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:15:06Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:15:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://eec99f8d1642efa138623423a9119e138850ae7f4e250263d3d66c34eec5c607
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://eec99f8d1642efa138623423a9119e138850ae7f4e250263d3d66c34eec5c607
          exitCode: 0
          finishedAt: "2025-11-08T10:15:05Z"
          reason: Completed
          startedAt: "2025-11-08T10:15:04Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-z5ggt
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.197
    podIPs:
    - ip: 10.42.0.197
    qosClass: BestEffort
    startTime: "2025-11-08T10:15:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T10:30:00Z"
    generateName: bitpin-incremental-backup-29376630-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: a4841de6-b50e-40cb-bcec-8c700509dabb
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376630
      controller-uid: a4841de6-b50e-40cb-bcec-8c700509dabb
      job-name: bitpin-incremental-backup-29376630
    name: bitpin-incremental-backup-29376630-bmkbs
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376630
      uid: a4841de6-b50e-40cb-bcec-8c700509dabb
    resourceVersion: "149132"
    uid: 3a9cb0f0-ac47-4e65-b90a-e99671c8f7db
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-df4tr
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-df4tr
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:30:06Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:30:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:30:00Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:30:00Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:30:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://3acf72f356cf9f93886f69868ff6255a542a544a0ee13b3e68a5e95f40ffa724
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://3acf72f356cf9f93886f69868ff6255a542a544a0ee13b3e68a5e95f40ffa724
          exitCode: 0
          finishedAt: "2025-11-08T10:30:05Z"
          reason: Completed
          startedAt: "2025-11-08T10:30:04Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-df4tr
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.200
    podIPs:
    - ip: 10.42.0.200
    qosClass: BestEffort
    startTime: "2025-11-08T10:30:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T10:45:00Z"
    generateName: bitpin-incremental-backup-29376645-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 0133646f-dd0a-4158-9219-a98c7c3ffab2
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376645
      controller-uid: 0133646f-dd0a-4158-9219-a98c7c3ffab2
      job-name: bitpin-incremental-backup-29376645
    name: bitpin-incremental-backup-29376645-7gpsw
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376645
      uid: 0133646f-dd0a-4158-9219-a98c7c3ffab2
    resourceVersion: "150486"
    uid: 10136342-b03d-4772-b57c-05ca6d9543f4
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-rzqwt
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-rzqwt
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:45:07Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:45:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:45:06Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:45:06Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T10:45:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://f40a6e03f32770d4c4c41d559d218eca730e1b11068059a5d751d7f9c80ccf4f
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://f40a6e03f32770d4c4c41d559d218eca730e1b11068059a5d751d7f9c80ccf4f
          exitCode: 0
          finishedAt: "2025-11-08T10:45:05Z"
          reason: Completed
          startedAt: "2025-11-08T10:45:05Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-rzqwt
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.202
    podIPs:
    - ip: 10.42.0.202
    qosClass: BestEffort
    startTime: "2025-11-08T10:45:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T11:00:00Z"
    generateName: bitpin-incremental-backup-29376660-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 87a1ec44-e6a2-44f7-9de0-efcc746e9dcc
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376660
      controller-uid: 87a1ec44-e6a2-44f7-9de0-efcc746e9dcc
      job-name: bitpin-incremental-backup-29376660
    name: bitpin-incremental-backup-29376660-6lh8x
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376660
      uid: 87a1ec44-e6a2-44f7-9de0-efcc746e9dcc
    resourceVersion: "152251"
    uid: 55c2a2d3-78cd-4bca-aad0-de7fdfbfbfca
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-sxlc7
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-sxlc7
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:00:21Z"
      message: 'The node was low on resource: ephemeral-storage. Threshold quantity:
        1473883772, available: 2385760Ki. '
      reason: TerminationByKubelet
      status: "True"
      type: DisruptionTarget
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:00:21Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:00:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:00:21Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:00:21Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:00:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://069727d6a22f526ff8bfdf721caf76d620f6702c75656ed4d9ae17e7359f3f44
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://069727d6a22f526ff8bfdf721caf76d620f6702c75656ed4d9ae17e7359f3f44
          exitCode: 0
          finishedAt: "2025-11-08T11:00:20Z"
          reason: Completed
          startedAt: "2025-11-08T11:00:19Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-sxlc7
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.204
    podIPs:
    - ip: 10.42.0.204
    qosClass: BestEffort
    startTime: "2025-11-08T11:00:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T11:15:00Z"
    generateName: bitpin-incremental-backup-29376675-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: a2b35261-8f6e-47be-b16d-d1c541baee22
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376675
      controller-uid: a2b35261-8f6e-47be-b16d-d1c541baee22
      job-name: bitpin-incremental-backup-29376675
    name: bitpin-incremental-backup-29376675-5qjfm
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376675
      uid: a2b35261-8f6e-47be-b16d-d1c541baee22
    resourceVersion: "153918"
    uid: 7f7d471e-3e79-4804-8eb7-63e5b1de1e91
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-lhdvf
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-lhdvf
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:15:07Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:15:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:15:06Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:15:06Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:15:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://49a14bdc01268bf1b3cc9bc6563f0d673f827c07266cac67eae2a2fcf62ce22e
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://49a14bdc01268bf1b3cc9bc6563f0d673f827c07266cac67eae2a2fcf62ce22e
          exitCode: 0
          finishedAt: "2025-11-08T11:15:05Z"
          reason: Completed
          startedAt: "2025-11-08T11:15:04Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-lhdvf
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.212
    podIPs:
    - ip: 10.42.0.212
    qosClass: BestEffort
    startTime: "2025-11-08T11:15:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T11:30:00Z"
    generateName: bitpin-incremental-backup-29376690-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 25d403f2-3004-418f-a155-d3244f4ad078
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376690
      controller-uid: 25d403f2-3004-418f-a155-d3244f4ad078
      job-name: bitpin-incremental-backup-29376690
    name: bitpin-incremental-backup-29376690-9r6lq
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376690
      uid: 25d403f2-3004-418f-a155-d3244f4ad078
    resourceVersion: "155273"
    uid: fd47fcd7-8d3e-4d9c-848a-6d36a11b06cf
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-kdm2l
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-kdm2l
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:30:07Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:30:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:30:06Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:30:06Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:30:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://3945032edc5a72efae6e737f19b8c5408a47139a2cdffc9636c83a35a121a1a4
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://3945032edc5a72efae6e737f19b8c5408a47139a2cdffc9636c83a35a121a1a4
          exitCode: 0
          finishedAt: "2025-11-08T11:30:05Z"
          reason: Completed
          startedAt: "2025-11-08T11:30:05Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-kdm2l
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.214
    podIPs:
    - ip: 10.42.0.214
    qosClass: BestEffort
    startTime: "2025-11-08T11:30:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T11:45:00Z"
    generateName: bitpin-incremental-backup-29376705-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: a44892d8-0ea2-490e-88ab-8a540b9d6bbc
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376705
      controller-uid: a44892d8-0ea2-490e-88ab-8a540b9d6bbc
      job-name: bitpin-incremental-backup-29376705
    name: bitpin-incremental-backup-29376705-zfszv
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376705
      uid: a44892d8-0ea2-490e-88ab-8a540b9d6bbc
    resourceVersion: "156624"
    uid: 4c101016-cde3-41a7-8ef5-adc2dbaaa653
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-g2g7l
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-g2g7l
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:45:07Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:45:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:45:06Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:45:06Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T11:45:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://70abe7288513608e1e72f2adc012c641a42f26e1dd2063d83fe63651c2b4c817
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://70abe7288513608e1e72f2adc012c641a42f26e1dd2063d83fe63651c2b4c817
          exitCode: 0
          finishedAt: "2025-11-08T11:45:05Z"
          reason: Completed
          startedAt: "2025-11-08T11:45:04Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-g2g7l
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.215
    podIPs:
    - ip: 10.42.0.215
    qosClass: BestEffort
    startTime: "2025-11-08T11:45:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T12:00:00Z"
    generateName: bitpin-incremental-backup-29376720-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: e15d858a-f7bb-4018-b4bd-f2079af8d2b8
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376720
      controller-uid: e15d858a-f7bb-4018-b4bd-f2079af8d2b8
      job-name: bitpin-incremental-backup-29376720
    name: bitpin-incremental-backup-29376720-h5snq
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376720
      uid: e15d858a-f7bb-4018-b4bd-f2079af8d2b8
    resourceVersion: "157973"
    uid: 4c4a0b9e-552d-47b2-b5d9-254d996b6b26
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-vr4xq
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-vr4xq
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:00:07Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:00:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:00:00Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:00:00Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:00:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://0cc8d2e319cc5489d8a3bd2da96a2eca347058d630c09bfb2a082572a00e5983
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://0cc8d2e319cc5489d8a3bd2da96a2eca347058d630c09bfb2a082572a00e5983
          exitCode: 0
          finishedAt: "2025-11-08T12:00:05Z"
          reason: Completed
          startedAt: "2025-11-08T12:00:05Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-vr4xq
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.217
    podIPs:
    - ip: 10.42.0.217
    qosClass: BestEffort
    startTime: "2025-11-08T12:00:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T12:15:00Z"
    generateName: bitpin-incremental-backup-29376735-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: fee92719-45bd-4422-9d48-62779621c094
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376735
      controller-uid: fee92719-45bd-4422-9d48-62779621c094
      job-name: bitpin-incremental-backup-29376735
    name: bitpin-incremental-backup-29376735-992m8
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376735
      uid: fee92719-45bd-4422-9d48-62779621c094
    resourceVersion: "159510"
    uid: bcf52d0e-34b2-4826-90ed-73071c185635
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-crghg
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-crghg
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:15:07Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:15:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:15:00Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:15:00Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:15:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://0d60a237faca5dd44bf57d6b4584a48e959eaf7dc73afed94348fccd14a56166
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://0d60a237faca5dd44bf57d6b4584a48e959eaf7dc73afed94348fccd14a56166
          exitCode: 0
          finishedAt: "2025-11-08T12:15:05Z"
          reason: Completed
          startedAt: "2025-11-08T12:15:05Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-crghg
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.220
    podIPs:
    - ip: 10.42.0.220
    qosClass: BestEffort
    startTime: "2025-11-08T12:15:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T12:30:00Z"
    generateName: bitpin-incremental-backup-29376750-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 8ca0ba09-ae29-4613-add4-9fa26934b026
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376750
      controller-uid: 8ca0ba09-ae29-4613-add4-9fa26934b026
      job-name: bitpin-incremental-backup-29376750
    name: bitpin-incremental-backup-29376750-dcj97
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376750
      uid: 8ca0ba09-ae29-4613-add4-9fa26934b026
    resourceVersion: "160865"
    uid: f2d48437-e8a4-426b-a651-5b56fd577b5d
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-sjq6n
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-sjq6n
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:30:06Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:30:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:30:00Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:30:00Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:30:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://ea40c27bac681d3af00b138f1969b3ce07735360eddab7596db889781c47ee57
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://ea40c27bac681d3af00b138f1969b3ce07735360eddab7596db889781c47ee57
          exitCode: 0
          finishedAt: "2025-11-08T12:30:05Z"
          reason: Completed
          startedAt: "2025-11-08T12:30:04Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-sjq6n
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.222
    podIPs:
    - ip: 10.42.0.222
    qosClass: BestEffort
    startTime: "2025-11-08T12:30:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T12:45:00Z"
    generateName: bitpin-incremental-backup-29376765-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 784d712d-98bc-4a6e-a73a-4614d78dc228
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376765
      controller-uid: 784d712d-98bc-4a6e-a73a-4614d78dc228
      job-name: bitpin-incremental-backup-29376765
    name: bitpin-incremental-backup-29376765-jkx7s
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376765
      uid: 784d712d-98bc-4a6e-a73a-4614d78dc228
    resourceVersion: "162214"
    uid: 765e9892-cadf-46bb-a345-92ace1e0ad1d
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-rfhn6
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-rfhn6
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:45:06Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:45:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:45:00Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:45:00Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T12:45:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://3ae9bce1faa427b964b5bb39763fb8cfca51a0aae9216556f7116a22eca7bf8d
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://3ae9bce1faa427b964b5bb39763fb8cfca51a0aae9216556f7116a22eca7bf8d
          exitCode: 0
          finishedAt: "2025-11-08T12:45:05Z"
          reason: Completed
          startedAt: "2025-11-08T12:45:04Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-rfhn6
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.223
    podIPs:
    - ip: 10.42.0.223
    qosClass: BestEffort
    startTime: "2025-11-08T12:45:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T13:00:00Z"
    generateName: bitpin-incremental-backup-29376780-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: b3226042-bd38-4f27-9d1d-c70e16099ab4
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376780
      controller-uid: b3226042-bd38-4f27-9d1d-c70e16099ab4
      job-name: bitpin-incremental-backup-29376780
    name: bitpin-incremental-backup-29376780-kn549
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376780
      uid: b3226042-bd38-4f27-9d1d-c70e16099ab4
    resourceVersion: "163565"
    uid: ec494787-65cd-4e8e-a095-2c919dcc45d0
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-mq872
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-mq872
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T13:00:07Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T13:00:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T13:00:06Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T13:00:06Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T13:00:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://fbfff43e9e2e3cceaea4345dd9b639febc9e7c186aa02cc1907678916a72e262
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://fbfff43e9e2e3cceaea4345dd9b639febc9e7c186aa02cc1907678916a72e262
          exitCode: 0
          finishedAt: "2025-11-08T13:00:05Z"
          reason: Completed
          startedAt: "2025-11-08T13:00:05Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-mq872
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.225
    podIPs:
    - ip: 10.42.0.225
    qosClass: BestEffort
    startTime: "2025-11-08T13:00:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T13:15:00Z"
    generateName: bitpin-incremental-backup-29376795-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 5f767372-53ae-4cac-8f6c-a1bd523e4cd5
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376795
      controller-uid: 5f767372-53ae-4cac-8f6c-a1bd523e4cd5
      job-name: bitpin-incremental-backup-29376795
    name: bitpin-incremental-backup-29376795-xrl7z
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376795
      uid: 5f767372-53ae-4cac-8f6c-a1bd523e4cd5
    resourceVersion: "164913"
    uid: 417c1b22-abb6-4779-92af-e9cd76323054
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-djt5p
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-djt5p
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T13:15:07Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T13:15:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T13:15:06Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T13:15:06Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T13:15:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://d4374fc1682baa644618404a1122de641e0b06687e8efdfadecb1c4e00811e13
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://d4374fc1682baa644618404a1122de641e0b06687e8efdfadecb1c4e00811e13
          exitCode: 0
          finishedAt: "2025-11-08T13:15:05Z"
          reason: Completed
          startedAt: "2025-11-08T13:15:04Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-djt5p
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.227
    podIPs:
    - ip: 10.42.0.227
    qosClass: BestEffort
    startTime: "2025-11-08T13:15:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T13:30:00Z"
    generateName: bitpin-incremental-backup-29376810-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 36b522f0-87dd-4fdb-8d97-bf1132984684
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376810
      controller-uid: 36b522f0-87dd-4fdb-8d97-bf1132984684
      job-name: bitpin-incremental-backup-29376810
    name: bitpin-incremental-backup-29376810-flzg2
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: bitpin-incremental-backup-29376810
      uid: 36b522f0-87dd-4fdb-8d97-bf1132984684
    resourceVersion: "166256"
    uid: edfac1ea-0285-4104-88d2-5181ba85548f
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-7wlg4
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-7wlg4
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T13:30:06Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T13:30:00Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T13:30:00Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T13:30:00Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T13:30:00Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://eabe2136bfc79ad8903d3c4264726b991a0592ef4aa98f6f9727bdda380bf4c9
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://eabe2136bfc79ad8903d3c4264726b991a0592ef4aa98f6f9727bdda380bf4c9
          exitCode: 0
          finishedAt: "2025-11-08T13:30:05Z"
          reason: Completed
          startedAt: "2025-11-08T13:30:04Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-7wlg4
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.229
    podIPs:
    - ip: 10.42.0.229
    qosClass: BestEffort
    startTime: "2025-11-08T13:30:00Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T08:25:14Z"
    generateName: manual-backup-20251108-115514-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: d22e0f51-6821-42f0-8142-0cb40821711f
      batch.kubernetes.io/job-name: manual-backup-20251108-115514
      controller-uid: d22e0f51-6821-42f0-8142-0cb40821711f
      job-name: manual-backup-20251108-115514
    name: manual-backup-20251108-115514-gc7rj
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: manual-backup-20251108-115514
      uid: d22e0f51-6821-42f0-8142-0cb40821711f
    resourceVersion: "137744"
    uid: f49bd96e-0a16-49fe-91cd-fabd835cc030
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - |
        set -e
        echo "=== Starting PostgreSQL Backup ==="
        echo "Time: $(date)"

        # تنظیم متغیرها
        BACKUP_DIR="/backups/full"
        BACKUP_FILE="$BACKUP_DIR/backup-$(date +%Y%m%d-%H%M%S).dump"
        LOG_FILE="$BACKUP_DIR/backup-$(date +%Y%m%d-%H%M%S).log"

        # ایجاد دایرکتوری اگر وجود ندارد
        mkdir -p $BACKUP_DIR

        echo "Backup directory: $BACKUP_DIR"
        echo "Backup file: $BACKUP_FILE"

        # گرفتن بکاپ
        echo "Starting pg_dump..."
        PGPASSWORD="jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s" pg_dump \
          -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \
          -p 5432 \
          -U bitpin_user \
          -d bitpin_db \
          --verbose \
          --format=custom \
          --compress=9 \
          --file="$BACKUP_FILE" 2>&1 | tee $LOG_FILE

        # بررسی موفقیت آمیز بودن بکاپ
        if [ ${PIPESTATUS[0]} -eq 0 ]; then
            echo "✓ Backup completed successfully"
            BACKUP_SIZE=$(du -h "$BACKUP_FILE" | cut -f1)
            echo "✓ Backup size: $BACKUP_SIZE"
        else
            echo "✗ Backup failed!"
            exit 1
        fi

        # لیست بکاپ‌های موجود
        echo "=== Current backups ==="
        ls -la $BACKUP_DIR/*.dump 2>/dev/null || echo "No backup files found"

        # حذف بکاپ‌های قدیمی (بیش از ۷ روز)
        echo "=== Cleaning up old backups ==="
        find $BACKUP_DIR -name "*.dump" -mtime +7 -delete
        find $BACKUP_DIR -name "*.log" -mtime +7 -delete

        echo "✓ Cleanup completed"
        echo "=== Backup process finished ==="
        echo "Time: $(date)"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: postgres-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-cz28x
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-cz28x
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:25:17Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:25:14Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:25:14Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:25:14Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:25:14Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://ffd01b161053c122af3ab9a4acfb6cb4dc6dba4c7e95995a6e99fb3f04b6d254
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: postgres-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://ffd01b161053c122af3ab9a4acfb6cb4dc6dba4c7e95995a6e99fb3f04b6d254
          exitCode: 0
          finishedAt: "2025-11-08T08:25:15Z"
          reason: Completed
          startedAt: "2025-11-08T08:25:15Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-cz28x
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.178
    podIPs:
    - ip: 10.42.0.178
    qosClass: BestEffort
    startTime: "2025-11-08T08:25:14Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T08:33:27Z"
    generateName: manual-backup-20251108-120327-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: b4b8006c-4758-417b-a865-a593b5f2b9ce
      batch.kubernetes.io/job-name: manual-backup-20251108-120327
      controller-uid: b4b8006c-4758-417b-a865-a593b5f2b9ce
      job-name: manual-backup-20251108-120327
    name: manual-backup-20251108-120327-lgrrt
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: manual-backup-20251108-120327
      uid: b4b8006c-4758-417b-a865-a593b5f2b9ce
    resourceVersion: "138485"
    uid: 8e960694-2325-4a99-b7f7-0c9abb35744b
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - |
        set -e
        echo "=== Starting PostgreSQL Backup ==="
        echo "Time: $(date)"

        # تنظیم متغیرها
        BACKUP_DIR="/backups/full"
        BACKUP_FILE="$BACKUP_DIR/backup-$(date +%Y%m%d-%H%M%S).dump"
        LOG_FILE="$BACKUP_DIR/backup-$(date +%Y%m%d-%H%M%S).log"

        # ایجاد دایرکتوری اگر وجود ندارد
        mkdir -p $BACKUP_DIR

        echo "Backup directory: $BACKUP_DIR"
        echo "Backup file: $BACKUP_FILE"

        # گرفتن بکاپ
        echo "Starting pg_dump..."
        PGPASSWORD="jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s" pg_dump \
          -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \
          -p 5432 \
          -U bitpin_user \
          -d bitpin_db \
          --verbose \
          --format=custom \
          --compress=9 \
          --file="$BACKUP_FILE" 2>&1 | tee $LOG_FILE

        # بررسی موفقیت آمیز بودن بکاپ
        if [ ${PIPESTATUS[0]} -eq 0 ]; then
            echo "✓ Backup completed successfully"
            BACKUP_SIZE=$(du -h "$BACKUP_FILE" | cut -f1)
            echo "✓ Backup size: $BACKUP_SIZE"
        else
            echo "✗ Backup failed!"
            exit 1
        fi

        # لیست بکاپ‌های موجود
        echo "=== Current backups ==="
        ls -la $BACKUP_DIR/*.dump 2>/dev/null || echo "No backup files found"

        # حذف بکاپ‌های قدیمی (بیش از ۷ روز)
        echo "=== Cleaning up old backups ==="
        find $BACKUP_DIR -name "*.dump" -mtime +7 -delete
        find $BACKUP_DIR -name "*.log" -mtime +7 -delete

        echo "✓ Cleanup completed"
        echo "=== Backup process finished ==="
        echo "Time: $(date)"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: postgres-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-4jdg7
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-4jdg7
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:33:30Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:33:27Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:33:27Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:33:27Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:33:27Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://51b846373dacc4799127e3c0d3958bb857991f3b9b8a32ea7233838ae28fa17d
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: postgres-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://51b846373dacc4799127e3c0d3958bb857991f3b9b8a32ea7233838ae28fa17d
          exitCode: 0
          finishedAt: "2025-11-08T08:33:28Z"
          reason: Completed
          startedAt: "2025-11-08T08:33:28Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-4jdg7
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.180
    podIPs:
    - ip: 10.42.0.180
    qosClass: BestEffort
    startTime: "2025-11-08T08:33:27Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T08:34:23Z"
    generateName: manual-backup-20251108-120423-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 4a82ee90-a7fd-4413-b7f9-f0426ef51c28
      batch.kubernetes.io/job-name: manual-backup-20251108-120423
      controller-uid: 4a82ee90-a7fd-4413-b7f9-f0426ef51c28
      job-name: manual-backup-20251108-120423
    name: manual-backup-20251108-120423-8lzvk
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: manual-backup-20251108-120423
      uid: 4a82ee90-a7fd-4413-b7f9-f0426ef51c28
    resourceVersion: "138578"
    uid: b391ec87-0403-4559-a7b4-dcbb16eb8677
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - |
        set -e
        echo "=== Starting PostgreSQL Backup ==="
        echo "Time: $(date)"

        # تنظیم متغیرها
        BACKUP_DIR="/backups/full"
        BACKUP_FILE="$BACKUP_DIR/backup-$(date +%Y%m%d-%H%M%S).dump"
        LOG_FILE="$BACKUP_DIR/backup-$(date +%Y%m%d-%H%M%S).log"

        # ایجاد دایرکتوری اگر وجود ندارد
        mkdir -p $BACKUP_DIR

        echo "Backup directory: $BACKUP_DIR"
        echo "Backup file: $BACKUP_FILE"

        # گرفتن بکاپ
        echo "Starting pg_dump..."
        PGPASSWORD="jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s" pg_dump \
          -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \
          -p 5432 \
          -U bitpin_user \
          -d bitpin_db \
          --verbose \
          --format=custom \
          --compress=9 \
          --file="$BACKUP_FILE" 2>&1 | tee $LOG_FILE

        # بررسی موفقیت آمیز بودن بکاپ
        if [ ${PIPESTATUS[0]} -eq 0 ]; then
            echo "✓ Backup completed successfully"
            BACKUP_SIZE=$(du -h "$BACKUP_FILE" | cut -f1)
            echo "✓ Backup size: $BACKUP_SIZE"
        else
            echo "✗ Backup failed!"
            exit 1
        fi

        # لیست بکاپ‌های موجود
        echo "=== Current backups ==="
        ls -la $BACKUP_DIR/*.dump 2>/dev/null || echo "No backup files found"

        # حذف بکاپ‌های قدیمی (بیش از ۷ روز)
        echo "=== Cleaning up old backups ==="
        find $BACKUP_DIR -name "*.dump" -mtime +7 -delete
        find $BACKUP_DIR -name "*.log" -mtime +7 -delete

        echo "✓ Cleanup completed"
        echo "=== Backup process finished ==="
        echo "Time: $(date)"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: postgres-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-4wdq6
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-4wdq6
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:34:26Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:34:24Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:34:24Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:34:24Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:34:23Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://293a80aea9f6746e0350e9d41f400ba1caee4872148472b05acd66360d892911
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: postgres-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://293a80aea9f6746e0350e9d41f400ba1caee4872148472b05acd66360d892911
          exitCode: 0
          finishedAt: "2025-11-08T08:34:24Z"
          reason: Completed
          startedAt: "2025-11-08T08:34:24Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-4wdq6
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.181
    podIPs:
    - ip: 10.42.0.181
    qosClass: BestEffort
    startTime: "2025-11-08T08:34:24Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T08:35:05Z"
    generateName: manual-backup-20251108-120505-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 7553f292-8b3c-4ea0-b0c5-dac19c11fdfb
      batch.kubernetes.io/job-name: manual-backup-20251108-120505
      controller-uid: 7553f292-8b3c-4ea0-b0c5-dac19c11fdfb
      job-name: manual-backup-20251108-120505
    name: manual-backup-20251108-120505-qf94j
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: manual-backup-20251108-120505
      uid: 7553f292-8b3c-4ea0-b0c5-dac19c11fdfb
    resourceVersion: "138670"
    uid: cf083425-c772-4aa4-b563-f001ad36e9d6
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - |
        set -e
        echo "=== Starting PostgreSQL Backup ==="
        echo "Time: $(date)"

        # تنظیم متغیرها
        BACKUP_DIR="/backups/full"
        BACKUP_FILE="$BACKUP_DIR/backup-$(date +%Y%m%d-%H%M%S).dump"
        LOG_FILE="$BACKUP_DIR/backup-$(date +%Y%m%d-%H%M%S).log"

        # ایجاد دایرکتوری اگر وجود ندارد
        mkdir -p $BACKUP_DIR

        echo "Backup directory: $BACKUP_DIR"
        echo "Backup file: $BACKUP_FILE"

        # گرفتن بکاپ
        echo "Starting pg_dump..."
        PGPASSWORD="jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s" pg_dump \
          -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \
          -p 5432 \
          -U bitpin_user \
          -d bitpin_db \
          --verbose \
          --format=custom \
          --compress=9 \
          --file="$BACKUP_FILE" 2>&1 | tee $LOG_FILE

        # بررسی موفقیت آمیز بودن بکاپ
        if [ ${PIPESTATUS[0]} -eq 0 ]; then
            echo "✓ Backup completed successfully"
            BACKUP_SIZE=$(du -h "$BACKUP_FILE" | cut -f1)
            echo "✓ Backup size: $BACKUP_SIZE"
        else
            echo "✗ Backup failed!"
            exit 1
        fi

        # لیست بکاپ‌های موجود
        echo "=== Current backups ==="
        ls -la $BACKUP_DIR/*.dump 2>/dev/null || echo "No backup files found"

        # حذف بکاپ‌های قدیمی (بیش از ۷ روز)
        echo "=== Cleaning up old backups ==="
        find $BACKUP_DIR -name "*.dump" -mtime +7 -delete
        find $BACKUP_DIR -name "*.log" -mtime +7 -delete

        echo "✓ Cleanup completed"
        echo "=== Backup process finished ==="
        echo "Time: $(date)"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: postgres-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-wpxsg
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-wpxsg
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:35:08Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:35:05Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:35:05Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:35:05Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:35:05Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://514245b7a7167c745d73066649e29785957aa553d5ed9872f46899b8a9d57c6d
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: postgres-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://514245b7a7167c745d73066649e29785957aa553d5ed9872f46899b8a9d57c6d
          exitCode: 0
          finishedAt: "2025-11-08T08:35:06Z"
          reason: Completed
          startedAt: "2025-11-08T08:35:06Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-wpxsg
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.182
    podIPs:
    - ip: 10.42.0.182
    qosClass: BestEffort
    startTime: "2025-11-08T08:35:05Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T08:36:16Z"
    generateName: manual-backup-20251108-120615-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 912b1c4e-e1c0-4e3d-a7b8-28d76a5913b1
      batch.kubernetes.io/job-name: manual-backup-20251108-120615
      controller-uid: 912b1c4e-e1c0-4e3d-a7b8-28d76a5913b1
      job-name: manual-backup-20251108-120615
    name: manual-backup-20251108-120615-mzwr9
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: manual-backup-20251108-120615
      uid: 912b1c4e-e1c0-4e3d-a7b8-28d76a5913b1
    resourceVersion: "138810"
    uid: f63e63cf-0eb1-4196-b6f7-840734808f87
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Backup ===\"\necho \"Time: $(date)\"\n\n#
        تنظیم متغیرها\nBACKUP_DIR=\"/backups/full\"\nTIMESTAMP=$(date +%Y%m%d-%H%M%S)\nBACKUP_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.dump\"\nCOMPRESSED_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.log\"\n\n#
        ایجاد دایرکتوری اگر وجود ندارد\nmkdir -p $BACKUP_DIR\n\necho \"Backup directory:
        $BACKUP_DIR\"\necho \"Backup file: $BACKUP_FILE\"\necho \"Compressed file:
        $COMPRESSED_FILE\"\n\n# گرفتن بکاپ و فشرده‌سازی مستقیم\necho \"Starting pg_dump
        with compression...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --verbose \\\n  --format=custom
        \\\n  2>&1 | tee $LOG_FILE | gzip > $COMPRESSED_FILE\n\n# بررسی موفقیت آمیز
        بودن بکاپ\nif [ ${PIPESTATUS[0]} -eq 0 ]; then\n    echo \"✓ Backup completed
        successfully\"\n    COMPRESSED_SIZE=$(du -h \"$COMPRESSED_FILE\" | cut -f1)\n
        \   echo \"✓ Compressed backup size: $COMPRESSED_SIZE\"\n    \n    # محاسبه
        نسبت فشرده‌سازی (اختیاری)\n    echo \"✓ Backup compressed to: $COMPRESSED_FILE\"\nelse\n
        \   echo \"✗ Backup failed!\"\n    exit 1\nfi\n\n# لیست بکاپ‌های موجود\necho
        \"=== Current backups ===\"\nls -la $BACKUP_DIR/*.gz 2>/dev/null || echo \"No
        backup files found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning
        up old backups ===\"\nfind $BACKUP_DIR -name \"*.gz\" -mtime +7 -delete\nfind
        $BACKUP_DIR -name \"*.log\" -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho
        \"=== Backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: postgres-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-5ll62
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-5ll62
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:36:22Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:36:16Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:36:16Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:36:16Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:36:16Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://b19fe555ef5070f60a4c482e26a0e21d140f5825205871932af9c7ed72d6a7c5
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: postgres-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://b19fe555ef5070f60a4c482e26a0e21d140f5825205871932af9c7ed72d6a7c5
          exitCode: 0
          finishedAt: "2025-11-08T08:36:21Z"
          reason: Completed
          startedAt: "2025-11-08T08:36:20Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-5ll62
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.183
    podIPs:
    - ip: 10.42.0.183
    qosClass: BestEffort
    startTime: "2025-11-08T08:36:16Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T08:20:59Z"
    generateName: test-db-connection-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 1c7c96b7-8f9c-4578-8451-0a02fedaee04
      batch.kubernetes.io/job-name: test-db-connection
      controller-uid: 1c7c96b7-8f9c-4578-8451-0a02fedaee04
      job-name: test-db-connection
    name: test-db-connection-thkwh
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: test-db-connection
      uid: 1c7c96b7-8f9c-4578-8451-0a02fedaee04
    resourceVersion: "137383"
    uid: c0d1d05f-46ce-4252-8c6a-5dd1738963bc
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - |
        echo "Testing database connection..."

        # تست اتصال ساده
        PGPASSWORD="jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s" psql \
          -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \
          -U bitpin_user \
          -d bitpin_db \
          -c "SELECT current_timestamp as time, current_database() as database, version();"

        echo "✓ Database connection successful!"

        # تست دایرکتوری بکاپ
        echo "Testing backup directory..."
        BACKUP_DIR="/backups/full"
        mkdir -p $BACKUP_DIR
        touch "$BACKUP_DIR/test-write-$(date +%Y%m%d-%H%M%S).txt"
        ls -la $BACKUP_DIR/
        echo "✓ Directory write test successful!"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: test-connection
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-bpvn7
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: Never
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-bpvn7
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:21:02Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:20:59Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:20:59Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:20:59Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:20:59Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://eebd90254ca8958a5643e5c37949e1fc0e0d941de659ef3253e4ad4e1dd212fd
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: test-connection
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://eebd90254ca8958a5643e5c37949e1fc0e0d941de659ef3253e4ad4e1dd212fd
          exitCode: 0
          finishedAt: "2025-11-08T08:21:00Z"
          reason: Completed
          startedAt: "2025-11-08T08:21:00Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-bpvn7
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.177
    podIPs:
    - ip: 10.42.0.177
    qosClass: BestEffort
    startTime: "2025-11-08T08:20:59Z"
- apiVersion: v1
  kind: Pod
  metadata:
    creationTimestamp: "2025-11-08T08:48:10Z"
    generateName: test-incremental-20251108-121810-
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 7cfadd21-1922-4866-8433-74f2af6afa0e
      batch.kubernetes.io/job-name: test-incremental-20251108-121810
      controller-uid: 7cfadd21-1922-4866-8433-74f2af6afa0e
      job-name: test-incremental-20251108-121810
    name: test-incremental-20251108-121810-nm6xt
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: Job
      name: test-incremental-20251108-121810
      uid: 7cfadd21-1922-4866-8433-74f2af6afa0e
    resourceVersion: "139872"
    uid: 0d67f20d-1962-44eb-8929-971195244c42
  spec:
    containers:
    - command:
      - /bin/bash
      - -c
      - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time:
        $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
        +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
        -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup:
        $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ
        schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup
        is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
        -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
        \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
        \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
        \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
        \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup:
        $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم
        مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental
        data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
        pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p
        5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose
        \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n# بررسی
        موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data
        backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
        | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema
        هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
        ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
        \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
        \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
        آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
        2>/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های
        قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind
        $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name
        \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\"
        -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental
        backup process finished ===\"\necho \"Time: $(date)\"\n"
      image: postgres:15
      imagePullPolicy: IfNotPresent
      name: incremental-backup
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-p4srg
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: mobin-log-backup-able
    nodeSelector:
      kubernetes.io/hostname: mobin-log-backup-able
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: OnFailure
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - hostPath:
        path: /mnt/backups
        type: Directory
      name: backup-storage
    - name: kube-api-access-p4srg
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:48:17Z"
      status: "False"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:48:10Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:48:10Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:48:10Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-11-08T08:48:10Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://9af8c7b9ebbdab90215a4e517faa10ddfc7dc3d2a511b5430cdeefdca2f4c067
      image: docker.io/library/postgres:15
      imageID: docker.io/library/postgres@sha256:822f8795764a670160640888508b2a68ea5c4b045012c2de17e1d0447bdbdc99
      lastState: {}
      name: incremental-backup
      ready: false
      resources: {}
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://9af8c7b9ebbdab90215a4e517faa10ddfc7dc3d2a511b5430cdeefdca2f4c067
          exitCode: 0
          finishedAt: "2025-11-08T08:48:15Z"
          reason: Completed
          startedAt: "2025-11-08T08:48:15Z"
      user:
        linux:
          gid: 0
          supplementalGroups:
          - 0
          uid: 0
      volumeMounts:
      - mountPath: /backups
        name: backup-storage
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-p4srg
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.33.3.42
    hostIPs:
    - ip: 10.33.3.42
    phase: Succeeded
    podIP: 10.42.0.185
    podIPs:
    - ip: 10.42.0.185
    qosClass: BestEffort
    startTime: "2025-11-08T08:48:10Z"
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"v1","kind":"Service","metadata":{"annotations":{},"name":"bitpin-app-svc","namespace":"bitpin-task"},"spec":{"ports":[{"port":80,"protocol":"TCP","targetPort":8000}],"selector":{"app":"bitpin-app"},"type":"ClusterIP"}}
    creationTimestamp: "2025-11-07T11:59:55Z"
    name: bitpin-app-svc
    namespace: bitpin-task
    resourceVersion: "48325"
    uid: a0a0de5f-dd29-4c0c-b3ee-a97970d2aec1
  spec:
    clusterIP: 10.43.111.48
    clusterIPs:
    - 10.43.111.48
    externalTrafficPolicy: Cluster
    internalTrafficPolicy: Cluster
    ipFamilies:
    - IPv4
    ipFamilyPolicy: SingleStack
    ports:
    - name: http
      nodePort: 30505
      port: 80
      protocol: TCP
      targetPort: 8000
    selector:
      app: bitpin-app
    sessionAffinity: None
    type: NodePort
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      cnpg.io/operatorVersion: 1.27.1
    creationTimestamp: "2025-11-07T10:00:03Z"
    labels:
      cnpg.io/cluster: bitpin-cluster
    name: bitpin-cluster-r
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: postgresql.cnpg.io/v1
      controller: true
      kind: Cluster
      name: bitpin-cluster
      uid: 1a43e070-4777-4a29-858a-c9313ba36c4a
    resourceVersion: "20506"
    uid: 1afcf7a4-ac52-4cc2-a535-dd0280517204
  spec:
    clusterIP: 10.43.218.194
    clusterIPs:
    - 10.43.218.194
    internalTrafficPolicy: Cluster
    ipFamilies:
    - IPv4
    ipFamilyPolicy: SingleStack
    ports:
    - name: postgres
      port: 5432
      protocol: TCP
      targetPort: 5432
    selector:
      cnpg.io/cluster: bitpin-cluster
      cnpg.io/podRole: instance
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      cnpg.io/operatorVersion: 1.27.1
    creationTimestamp: "2025-11-07T10:00:03Z"
    labels:
      cnpg.io/cluster: bitpin-cluster
    name: bitpin-cluster-ro
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: postgresql.cnpg.io/v1
      controller: true
      kind: Cluster
      name: bitpin-cluster
      uid: 1a43e070-4777-4a29-858a-c9313ba36c4a
    resourceVersion: "20512"
    uid: 9a0d54ff-71c3-465a-9545-ad323170a92a
  spec:
    clusterIP: 10.43.39.51
    clusterIPs:
    - 10.43.39.51
    internalTrafficPolicy: Cluster
    ipFamilies:
    - IPv4
    ipFamilyPolicy: SingleStack
    ports:
    - name: postgres
      port: 5432
      protocol: TCP
      targetPort: 5432
    selector:
      cnpg.io/cluster: bitpin-cluster
      cnpg.io/instanceRole: replica
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      cnpg.io/operatorVersion: 1.27.1
    creationTimestamp: "2025-11-07T10:00:03Z"
    labels:
      cnpg.io/cluster: bitpin-cluster
    name: bitpin-cluster-rw
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: postgresql.cnpg.io/v1
      controller: true
      kind: Cluster
      name: bitpin-cluster
      uid: 1a43e070-4777-4a29-858a-c9313ba36c4a
    resourceVersion: "20517"
    uid: 50764366-1196-4af7-83fa-0efe7decc9b2
  spec:
    clusterIP: 10.43.217.165
    clusterIPs:
    - 10.43.217.165
    internalTrafficPolicy: Cluster
    ipFamilies:
    - IPv4
    ipFamilyPolicy: SingleStack
    ports:
    - name: postgres
      port: 5432
      protocol: TCP
      targetPort: 5432
    selector:
      cnpg.io/cluster: bitpin-cluster
      cnpg.io/instanceRole: primary
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: apps/v1
  kind: Deployment
  metadata:
    annotations:
      deployment.kubernetes.io/revision: "18"
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"apps/v1","kind":"Deployment","metadata":{"annotations":{},"name":"bitpin-app","namespace":"bitpin-task"},"spec":{"replicas":1,"selector":{"matchLabels":{"app":"bitpin-app"}},"template":{"metadata":{"labels":{"app":"bitpin-app"}},"spec":{"containers":[{"env":[{"name":"DJANGO_SETTINGS_MODULE","value":"Exchange.settings"},{"name":"DATABASE_HOST","valueFrom":{"secretKeyRef":{"key":"host","name":"bitpin-cluster-app"}}},{"name":"DATABASE_PORT","valueFrom":{"secretKeyRef":{"key":"port","name":"bitpin-cluster-app"}}},{"name":"DATABASE_NAME","valueFrom":{"secretKeyRef":{"key":"dbname","name":"bitpin-cluster-app"}}},{"name":"DATABASE_USER","valueFrom":{"secretKeyRef":{"key":"user","name":"bitpin-cluster-app"}}},{"name":"DATABASE_PASSWORD","valueFrom":{"secretKeyRef":{"key":"password","name":"bitpin-cluster-app"}}}],"image":"yasaman664/bitpin-task:latest","livenessProbe":{"httpGet":{"path":"/healthz/","port":8000},"initialDelaySeconds":10,"periodSeconds":20},"name":"bitpin-app","ports":[{"containerPort":8000}],"readinessProbe":{"httpGet":{"path":"/healthz/","port":8000},"initialDelaySeconds":5,"periodSeconds":10},"volumeMounts":[{"mountPath":"/app/Exchange/static","name":"static-volume"},{"mountPath":"/app/Exchange/media","name":"media-volume"}]}],"volumes":[{"emptyDir":{},"name":"static-volume"},{"emptyDir":{},"name":"media-volume"}]}}}}
    creationTimestamp: "2025-11-07T11:59:54Z"
    generation: 18
    name: bitpin-app
    namespace: bitpin-task
    resourceVersion: "48068"
    uid: 0a4d233f-34d8-4e4e-8284-a2c4c405a740
  spec:
    progressDeadlineSeconds: 600
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      matchLabels:
        app: bitpin-app
    strategy:
      rollingUpdate:
        maxSurge: 25%
        maxUnavailable: 25%
      type: RollingUpdate
    template:
      metadata:
        annotations:
          kubectl.kubernetes.io/restartedAt: "2025-11-07T18:36:32+03:30"
        creationTimestamp: null
        labels:
          app: bitpin-app
      spec:
        containers:
        - env:
          - name: DJANGO_SETTINGS_MODULE
            value: Exchange.settings
          - name: DATABASE_HOST
            valueFrom:
              secretKeyRef:
                key: host
                name: bitpin-cluster-app
          - name: DATABASE_PORT
            valueFrom:
              secretKeyRef:
                key: port
                name: bitpin-cluster-app
          - name: DATABASE_NAME
            valueFrom:
              secretKeyRef:
                key: dbname
                name: bitpin-cluster-app
          - name: DATABASE_USER
            valueFrom:
              secretKeyRef:
                key: user
                name: bitpin-cluster-app
          - name: DATABASE_PASSWORD
            valueFrom:
              secretKeyRef:
                key: password
                name: bitpin-cluster-app
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /healthz/
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 20
            successThreshold: 1
            timeoutSeconds: 1
          name: bitpin-app
          ports:
          - containerPort: 8000
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /healthz/
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 5
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
          - mountPath: /app/Exchange/media
            name: media-volume
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - emptyDir: {}
          name: static-volume
        - emptyDir: {}
          name: media-volume
  status:
    availableReplicas: 1
    conditions:
    - lastTransitionTime: "2025-11-07T15:06:38Z"
      lastUpdateTime: "2025-11-07T15:06:38Z"
      message: Deployment has minimum availability.
      reason: MinimumReplicasAvailable
      status: "True"
      type: Available
    - lastTransitionTime: "2025-11-07T13:04:49Z"
      lastUpdateTime: "2025-11-07T15:13:30Z"
      message: ReplicaSet "bitpin-app-b776cb8bc" has successfully progressed.
      reason: NewReplicaSetAvailable
      status: "True"
      type: Progressing
    observedGeneration: 18
    readyReplicas: 1
    replicas: 1
    updatedReplicas: 1
- apiVersion: apps/v1
  kind: ReplicaSet
  metadata:
    annotations:
      deployment.kubernetes.io/desired-replicas: "1"
      deployment.kubernetes.io/max-replicas: "2"
      deployment.kubernetes.io/revision: "17"
    creationTimestamp: "2025-11-07T15:06:32Z"
    generation: 5
    labels:
      app: bitpin-app
      pod-template-hash: 5db4cf8b77
    name: bitpin-app-5db4cf8b77
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: apps/v1
      blockOwnerDeletion: true
      controller: true
      kind: Deployment
      name: bitpin-app
      uid: 0a4d233f-34d8-4e4e-8284-a2c4c405a740
    resourceVersion: "48067"
    uid: 84bea7fb-57e8-4e9a-9ead-a7ab7600804b
  spec:
    replicas: 0
    selector:
      matchLabels:
        app: bitpin-app
        pod-template-hash: 5db4cf8b77
    template:
      metadata:
        annotations:
          kubectl.kubernetes.io/restartedAt: "2025-11-07T18:36:32+03:30"
        creationTimestamp: null
        labels:
          app: bitpin-app
          pod-template-hash: 5db4cf8b77
      spec:
        containers:
        - env:
          - name: DJANGO_SETTINGS_MODULE
            value: Exchange.settings
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /healthz/
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 20
            successThreshold: 1
            timeoutSeconds: 1
          name: bitpin-app
          ports:
          - containerPort: 8000
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /healthz/
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 5
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
          - mountPath: /app/Exchange/media
            name: media-volume
        dnsPolicy: ClusterFirst
        initContainers:
        - command:
          - sh
          - -c
          - |
            echo "Running collectstatic..."
            python3 /app/Exchange/manage.py collectstatic --noinput
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          name: init-collectstatic
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - emptyDir: {}
          name: static-volume
        - emptyDir: {}
          name: media-volume
  status:
    observedGeneration: 5
    replicas: 0
- apiVersion: apps/v1
  kind: ReplicaSet
  metadata:
    annotations:
      deployment.kubernetes.io/desired-replicas: "1"
      deployment.kubernetes.io/max-replicas: "2"
      deployment.kubernetes.io/revision: "10"
    creationTimestamp: "2025-11-07T14:47:13Z"
    generation: 2
    labels:
      app: bitpin-app
      pod-template-hash: 5fdfc768
    name: bitpin-app-5fdfc768
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: apps/v1
      blockOwnerDeletion: true
      controller: true
      kind: Deployment
      name: bitpin-app
      uid: 0a4d233f-34d8-4e4e-8284-a2c4c405a740
    resourceVersion: "45865"
    uid: ceafa680-2e10-4951-8864-0f23e96312de
  spec:
    replicas: 0
    selector:
      matchLabels:
        app: bitpin-app
        pod-template-hash: 5fdfc768
    template:
      metadata:
        annotations:
          kubectl.kubernetes.io/restartedAt: "2025-11-07T16:57:32+03:30"
        creationTimestamp: null
        labels:
          app: bitpin-app
          pod-template-hash: 5fdfc768
      spec:
        containers:
        - env:
          - name: DJANGO_SETTINGS_MODULE
            value: Exchange.settings
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 30
            periodSeconds: 20
            successThreshold: 1
            timeoutSeconds: 1
          name: bitpin-app
          ports:
          - containerPort: 8000
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
          - mountPath: /app/Exchange/media
            name: media-volume
        dnsPolicy: ClusterFirst
        initContainers:
        - command:
          - sh
          - -c
          - |
            echo "Running collectstatic..."
            python3 /app/Exchange/manage.py collectstatic --noinput
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          name: init-collectstatic
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - emptyDir: {}
          name: static-volume
        - emptyDir: {}
          name: media-volume
  status:
    observedGeneration: 2
    replicas: 0
- apiVersion: apps/v1
  kind: ReplicaSet
  metadata:
    annotations:
      deployment.kubernetes.io/desired-replicas: "1"
      deployment.kubernetes.io/max-replicas: "2"
      deployment.kubernetes.io/revision: "8"
    creationTimestamp: "2025-11-07T14:27:02Z"
    generation: 3
    labels:
      app: bitpin-app
      pod-template-hash: 64bbd748bc
    name: bitpin-app-64bbd748bc
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: apps/v1
      blockOwnerDeletion: true
      controller: true
      kind: Deployment
      name: bitpin-app
      uid: 0a4d233f-34d8-4e4e-8284-a2c4c405a740
    resourceVersion: "43772"
    uid: ca0ca4bf-d4ec-4ed6-9108-bdacbea982c0
  spec:
    replicas: 0
    selector:
      matchLabels:
        app: bitpin-app
        pod-template-hash: 64bbd748bc
    template:
      metadata:
        annotations:
          kubectl.kubernetes.io/restartedAt: "2025-11-07T16:57:32+03:30"
        creationTimestamp: null
        labels:
          app: bitpin-app
          pod-template-hash: 64bbd748bc
      spec:
        containers:
        - env:
          - name: ALLOWED_HOSTS
            value: '*'
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 30
            periodSeconds: 20
            successThreshold: 1
            timeoutSeconds: 1
          name: bitpin-app
          ports:
          - containerPort: 8000
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
          - mountPath: /app/Exchange/media
            name: media-volume
        dnsPolicy: ClusterFirst
        initContainers:
        - command:
          - sh
          - -c
          - |
            python3 /app/Exchange/manage.py migrate --noinput &&
            python3 /app/Exchange/manage.py collectstatic --noinput
          env:
          - name: DATABASE_ENGINE
            value: django.db.backends.postgresql
          - name: DATABASE_NAME
            valueFrom:
              secretKeyRef:
                key: dbname
                name: bitpin-cluster-app
          - name: DATABASE_USER
            valueFrom:
              secretKeyRef:
                key: user
                name: bitpin-cluster-app
          - name: DATABASE_PASSWORD
            valueFrom:
              secretKeyRef:
                key: password
                name: bitpin-cluster-app
          - name: DATABASE_HOST
            valueFrom:
              secretKeyRef:
                key: host
                name: bitpin-cluster-app
          - name: DATABASE_PORT
            valueFrom:
              secretKeyRef:
                key: port
                name: bitpin-cluster-app
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          name: init-migrate-collectstatic
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
          - mountPath: /app/Exchange/media
            name: media-volume
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/bitpin-app/static
            type: DirectoryOrCreate
          name: static-volume
        - hostPath:
            path: /mnt/bitpin-app/media
            type: DirectoryOrCreate
          name: media-volume
  status:
    observedGeneration: 3
    replicas: 0
- apiVersion: apps/v1
  kind: ReplicaSet
  metadata:
    annotations:
      deployment.kubernetes.io/desired-replicas: "1"
      deployment.kubernetes.io/max-replicas: "2"
      deployment.kubernetes.io/revision: "13"
    creationTimestamp: "2025-11-07T14:52:29Z"
    generation: 3
    labels:
      app: bitpin-app
      pod-template-hash: 64dd56ffb6
    name: bitpin-app-64dd56ffb6
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: apps/v1
      blockOwnerDeletion: true
      controller: true
      kind: Deployment
      name: bitpin-app
      uid: 0a4d233f-34d8-4e4e-8284-a2c4c405a740
    resourceVersion: "45941"
    uid: fdea3d8a-6a3b-466d-961b-a8ab7a4ce3e1
  spec:
    replicas: 0
    selector:
      matchLabels:
        app: bitpin-app
        pod-template-hash: 64dd56ffb6
    template:
      metadata:
        annotations:
          kubectl.kubernetes.io/restartedAt: "2025-11-07T18:22:29+03:30"
        creationTimestamp: null
        labels:
          app: bitpin-app
          pod-template-hash: 64dd56ffb6
      spec:
        containers:
        - env:
          - name: DJANGO_SETTINGS_MODULE
            value: Exchange.settings
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 30
            periodSeconds: 20
            successThreshold: 1
            timeoutSeconds: 1
          name: bitpin-app
          ports:
          - containerPort: 8000
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
          - mountPath: /app/Exchange/media
            name: media-volume
        dnsPolicy: ClusterFirst
        initContainers:
        - command:
          - sh
          - -c
          - |
            echo "Running collectstatic..."
            python3 /app/Exchange/manage.py collectstatic --noinput
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          name: init-collectstatic
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - emptyDir: {}
          name: static-volume
        - emptyDir: {}
          name: media-volume
  status:
    observedGeneration: 3
    replicas: 0
- apiVersion: apps/v1
  kind: ReplicaSet
  metadata:
    annotations:
      deployment.kubernetes.io/desired-replicas: "1"
      deployment.kubernetes.io/max-replicas: "2"
      deployment.kubernetes.io/revision: "12"
    creationTimestamp: "2025-11-07T14:52:28Z"
    generation: 3
    labels:
      app: bitpin-app
      pod-template-hash: "7495649999"
    name: bitpin-app-7495649999
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: apps/v1
      blockOwnerDeletion: true
      controller: true
      kind: Deployment
      name: bitpin-app
      uid: 0a4d233f-34d8-4e4e-8284-a2c4c405a740
    resourceVersion: "45918"
    uid: 611fc096-f98f-4cd3-bc48-10238ac29c56
  spec:
    replicas: 0
    selector:
      matchLabels:
        app: bitpin-app
        pod-template-hash: "7495649999"
    template:
      metadata:
        annotations:
          kubectl.kubernetes.io/restartedAt: "2025-11-07T18:22:28+03:30"
        creationTimestamp: null
        labels:
          app: bitpin-app
          pod-template-hash: "7495649999"
      spec:
        containers:
        - env:
          - name: DJANGO_SETTINGS_MODULE
            value: Exchange.settings
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 30
            periodSeconds: 20
            successThreshold: 1
            timeoutSeconds: 1
          name: bitpin-app
          ports:
          - containerPort: 8000
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
          - mountPath: /app/Exchange/media
            name: media-volume
        dnsPolicy: ClusterFirst
        initContainers:
        - command:
          - sh
          - -c
          - |
            echo "Running collectstatic..."
            python3 /app/Exchange/manage.py collectstatic --noinput
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          name: init-collectstatic
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - emptyDir: {}
          name: static-volume
        - emptyDir: {}
          name: media-volume
  status:
    observedGeneration: 3
    replicas: 0
- apiVersion: apps/v1
  kind: ReplicaSet
  metadata:
    annotations:
      deployment.kubernetes.io/desired-replicas: "2"
      deployment.kubernetes.io/max-replicas: "3"
      deployment.kubernetes.io/revision: "16"
    creationTimestamp: "2025-11-07T15:06:21Z"
    generation: 3
    labels:
      app: bitpin-app
      pod-template-hash: 84559b9867
    name: bitpin-app-84559b9867
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: apps/v1
      blockOwnerDeletion: true
      controller: true
      kind: Deployment
      name: bitpin-app
      uid: 0a4d233f-34d8-4e4e-8284-a2c4c405a740
    resourceVersion: "47474"
    uid: f5afed1c-7a49-4d8c-b3d0-a71dc0830c60
  spec:
    replicas: 0
    selector:
      matchLabels:
        app: bitpin-app
        pod-template-hash: 84559b9867
    template:
      metadata:
        annotations:
          kubectl.kubernetes.io/restartedAt: "2025-11-07T18:30:18+03:30"
        creationTimestamp: null
        labels:
          app: bitpin-app
          pod-template-hash: 84559b9867
      spec:
        containers:
        - env:
          - name: DJANGO_SETTINGS_MODULE
            value: Exchange.settings
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /healthz/
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 20
            successThreshold: 1
            timeoutSeconds: 1
          name: bitpin-app
          ports:
          - containerPort: 8000
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /healthz/
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 5
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
          - mountPath: /app/Exchange/media
            name: media-volume
        dnsPolicy: ClusterFirst
        initContainers:
        - command:
          - sh
          - -c
          - |
            echo "Running collectstatic..."
            python3 /app/Exchange/manage.py collectstatic --noinput
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          name: init-collectstatic
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - emptyDir: {}
          name: static-volume
        - emptyDir: {}
          name: media-volume
  status:
    observedGeneration: 3
    replicas: 0
- apiVersion: apps/v1
  kind: ReplicaSet
  metadata:
    annotations:
      deployment.kubernetes.io/desired-replicas: "1"
      deployment.kubernetes.io/max-replicas: "2"
      deployment.kubernetes.io/revision: "14"
    creationTimestamp: "2025-11-07T14:52:30Z"
    generation: 3
    labels:
      app: bitpin-app
      pod-template-hash: 84c95cb476
    name: bitpin-app-84c95cb476
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: apps/v1
      blockOwnerDeletion: true
      controller: true
      kind: Deployment
      name: bitpin-app
      uid: 0a4d233f-34d8-4e4e-8284-a2c4c405a740
    resourceVersion: "46685"
    uid: a5426346-8417-43db-8ab9-7e86e96aaf5d
  spec:
    replicas: 0
    selector:
      matchLabels:
        app: bitpin-app
        pod-template-hash: 84c95cb476
    template:
      metadata:
        annotations:
          kubectl.kubernetes.io/restartedAt: "2025-11-07T18:22:30+03:30"
        creationTimestamp: null
        labels:
          app: bitpin-app
          pod-template-hash: 84c95cb476
      spec:
        containers:
        - env:
          - name: DJANGO_SETTINGS_MODULE
            value: Exchange.settings
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 30
            periodSeconds: 20
            successThreshold: 1
            timeoutSeconds: 1
          name: bitpin-app
          ports:
          - containerPort: 8000
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
          - mountPath: /app/Exchange/media
            name: media-volume
        dnsPolicy: ClusterFirst
        initContainers:
        - command:
          - sh
          - -c
          - |
            echo "Running collectstatic..."
            python3 /app/Exchange/manage.py collectstatic --noinput
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          name: init-collectstatic
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - emptyDir: {}
          name: static-volume
        - emptyDir: {}
          name: media-volume
  status:
    observedGeneration: 3
    replicas: 0
- apiVersion: apps/v1
  kind: ReplicaSet
  metadata:
    annotations:
      deployment.kubernetes.io/desired-replicas: "2"
      deployment.kubernetes.io/max-replicas: "3"
      deployment.kubernetes.io/revision: "15"
    creationTimestamp: "2025-11-07T15:00:18Z"
    generation: 5
    labels:
      app: bitpin-app
      pod-template-hash: 85dbd47f85
    name: bitpin-app-85dbd47f85
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: apps/v1
      blockOwnerDeletion: true
      controller: true
      kind: Deployment
      name: bitpin-app
      uid: 0a4d233f-34d8-4e4e-8284-a2c4c405a740
    resourceVersion: "47342"
    uid: 5478ca5d-ecd8-4365-9545-622cf8bdb007
  spec:
    replicas: 0
    selector:
      matchLabels:
        app: bitpin-app
        pod-template-hash: 85dbd47f85
    template:
      metadata:
        annotations:
          kubectl.kubernetes.io/restartedAt: "2025-11-07T18:30:18+03:30"
        creationTimestamp: null
        labels:
          app: bitpin-app
          pod-template-hash: 85dbd47f85
      spec:
        containers:
        - env:
          - name: DJANGO_SETTINGS_MODULE
            value: Exchange.settings
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 30
            periodSeconds: 20
            successThreshold: 1
            timeoutSeconds: 1
          name: bitpin-app
          ports:
          - containerPort: 8000
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
          - mountPath: /app/Exchange/media
            name: media-volume
        dnsPolicy: ClusterFirst
        initContainers:
        - command:
          - sh
          - -c
          - |
            echo "Running collectstatic..."
            python3 /app/Exchange/manage.py collectstatic --noinput
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          name: init-collectstatic
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - emptyDir: {}
          name: static-volume
        - emptyDir: {}
          name: media-volume
  status:
    observedGeneration: 5
    replicas: 0
- apiVersion: apps/v1
  kind: ReplicaSet
  metadata:
    annotations:
      deployment.kubernetes.io/desired-replicas: "1"
      deployment.kubernetes.io/max-replicas: "2"
      deployment.kubernetes.io/revision: "18"
    creationTimestamp: "2025-11-07T15:13:16Z"
    generation: 1
    labels:
      app: bitpin-app
      pod-template-hash: b776cb8bc
    name: bitpin-app-b776cb8bc
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: apps/v1
      blockOwnerDeletion: true
      controller: true
      kind: Deployment
      name: bitpin-app
      uid: 0a4d233f-34d8-4e4e-8284-a2c4c405a740
    resourceVersion: "48057"
    uid: 96ac6ddc-1ac5-472f-8a48-f3b1b915cea2
  spec:
    replicas: 1
    selector:
      matchLabels:
        app: bitpin-app
        pod-template-hash: b776cb8bc
    template:
      metadata:
        annotations:
          kubectl.kubernetes.io/restartedAt: "2025-11-07T18:36:32+03:30"
        creationTimestamp: null
        labels:
          app: bitpin-app
          pod-template-hash: b776cb8bc
      spec:
        containers:
        - env:
          - name: DJANGO_SETTINGS_MODULE
            value: Exchange.settings
          - name: DATABASE_HOST
            valueFrom:
              secretKeyRef:
                key: host
                name: bitpin-cluster-app
          - name: DATABASE_PORT
            valueFrom:
              secretKeyRef:
                key: port
                name: bitpin-cluster-app
          - name: DATABASE_NAME
            valueFrom:
              secretKeyRef:
                key: dbname
                name: bitpin-cluster-app
          - name: DATABASE_USER
            valueFrom:
              secretKeyRef:
                key: user
                name: bitpin-cluster-app
          - name: DATABASE_PASSWORD
            valueFrom:
              secretKeyRef:
                key: password
                name: bitpin-cluster-app
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /healthz/
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 20
            successThreshold: 1
            timeoutSeconds: 1
          name: bitpin-app
          ports:
          - containerPort: 8000
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /healthz/
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 5
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
          - mountPath: /app/Exchange/media
            name: media-volume
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - emptyDir: {}
          name: static-volume
        - emptyDir: {}
          name: media-volume
  status:
    availableReplicas: 1
    fullyLabeledReplicas: 1
    observedGeneration: 1
    readyReplicas: 1
    replicas: 1
- apiVersion: apps/v1
  kind: ReplicaSet
  metadata:
    annotations:
      deployment.kubernetes.io/desired-replicas: "1"
      deployment.kubernetes.io/max-replicas: "2"
      deployment.kubernetes.io/revision: "11"
    creationTimestamp: "2025-11-07T14:52:26Z"
    generation: 3
    labels:
      app: bitpin-app
      pod-template-hash: d489696fc
    name: bitpin-app-d489696fc
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: apps/v1
      blockOwnerDeletion: true
      controller: true
      kind: Deployment
      name: bitpin-app
      uid: 0a4d233f-34d8-4e4e-8284-a2c4c405a740
    resourceVersion: "45894"
    uid: 7cdc5bab-a6d0-4ac2-8186-3b1c3adb0590
  spec:
    replicas: 0
    selector:
      matchLabels:
        app: bitpin-app
        pod-template-hash: d489696fc
    template:
      metadata:
        annotations:
          kubectl.kubernetes.io/restartedAt: "2025-11-07T18:22:26+03:30"
        creationTimestamp: null
        labels:
          app: bitpin-app
          pod-template-hash: d489696fc
      spec:
        containers:
        - env:
          - name: DJANGO_SETTINGS_MODULE
            value: Exchange.settings
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 30
            periodSeconds: 20
            successThreshold: 1
            timeoutSeconds: 1
          name: bitpin-app
          ports:
          - containerPort: 8000
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /
              port: 8000
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
          - mountPath: /app/Exchange/media
            name: media-volume
        dnsPolicy: ClusterFirst
        initContainers:
        - command:
          - sh
          - -c
          - |
            echo "Running collectstatic..."
            python3 /app/Exchange/manage.py collectstatic --noinput
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          name: init-collectstatic
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/static
            name: static-volume
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - emptyDir: {}
          name: static-volume
        - emptyDir: {}
          name: media-volume
  status:
    observedGeneration: 3
    replicas: 0
- apiVersion: apps/v1
  kind: ReplicaSet
  metadata:
    annotations:
      deployment.kubernetes.io/desired-replicas: "2"
      deployment.kubernetes.io/max-replicas: "3"
      deployment.kubernetes.io/revision: "9"
    creationTimestamp: "2025-11-07T14:29:50Z"
    generation: 3
    labels:
      app: bitpin-app
      pod-template-hash: fcf548495
    name: bitpin-app-fcf548495
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: apps/v1
      blockOwnerDeletion: true
      controller: true
      kind: Deployment
      name: bitpin-app
      uid: 0a4d233f-34d8-4e4e-8284-a2c4c405a740
    resourceVersion: "47410"
    uid: 59db3b98-2908-490b-aada-5d4015193636
  spec:
    replicas: 0
    selector:
      matchLabels:
        app: bitpin-app
        pod-template-hash: fcf548495
    template:
      metadata:
        annotations:
          kubectl.kubernetes.io/restartedAt: "2025-11-07T16:57:32+03:30"
        creationTimestamp: null
        labels:
          app: bitpin-app
          pod-template-hash: fcf548495
      spec:
        containers:
        - env:
          - name: ALLOWED_HOSTS
            value: '*'
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          name: bitpin-app
          ports:
          - containerPort: 8000
            protocol: TCP
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/staticfiles
            name: static-volume
          - mountPath: /app/Exchange/media
            name: media-volume
        dnsPolicy: ClusterFirst
        initContainers:
        - command:
          - sh
          - -c
          - python3 /app/Exchange/manage.py collectstatic --noinput
          image: yasaman664/bitpin-task:latest
          imagePullPolicy: Always
          name: init-collectstatic
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /app/Exchange/staticfiles
            name: static-volume
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/bitpin-app/static
            type: DirectoryOrCreate
          name: static-volume
        - hostPath:
            path: /mnt/bitpin-app/media
            type: DirectoryOrCreate
          name: media-volume
  status:
    observedGeneration: 3
    replicas: 0
- apiVersion: batch/v1
  kind: CronJob
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"batch/v1","kind":"CronJob","metadata":{"annotations":{},"name":"bitpin-daily-backup","namespace":"bitpin-task"},"spec":{"jobTemplate":{"spec":{"template":{"spec":{"containers":[{"command":["/bin/bash","-c","set -e\necho \"=== Starting PostgreSQL Backup ===\"\necho \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/full\"\nTIMESTAMP=$(date +%Y%m%d-%H%M%S)\nBACKUP_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.dump\"\nCOMPRESSED_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.log\"\n\n# ایجاد دایرکتوری اگر وجود ندارد\nmkdir -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Backup file: $BACKUP_FILE\"\necho \"Compressed file: $COMPRESSED_FILE\"\n\n# گرفتن بکاپ و فشرده‌سازی مستقیم\necho \"Starting pg_dump with compression...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\" pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --verbose \\\n  --format=custom \\\n  2\u003e\u00261 | tee $LOG_FILE | gzip \u003e $COMPRESSED_FILE\n\n# بررسی موفقیت آمیز بودن بکاپ\nif [ ${PIPESTATUS[0]} -eq 0 ]; then\n    echo \"✓ Backup completed successfully\"\n    COMPRESSED_SIZE=$(du -h \"$COMPRESSED_FILE\" | cut -f1)\n    echo \"✓ Compressed backup size: $COMPRESSED_SIZE\"\n    \n    # محاسبه نسبت فشرده‌سازی (اختیاری)\n    echo \"✓ Backup compressed to: $COMPRESSED_FILE\"\nelse\n    echo \"✗ Backup failed!\"\n    exit 1\nfi\n\n# لیست بکاپ‌های موجود\necho \"=== Current backups ===\"\nls -la $BACKUP_DIR/*.gz 2\u003e/dev/null || echo \"No backup files found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old backups ===\"\nfind $BACKUP_DIR -name \"*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"*.log\" -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Backup process finished ===\"\necho \"Time: $(date)\"\n"],"image":"postgres:15","name":"postgres-backup","volumeMounts":[{"mountPath":"/backups","name":"backup-storage"}]}],"nodeSelector":{"kubernetes.io/hostname":"mobin-log-backup-able"},"restartPolicy":"OnFailure","volumes":[{"hostPath":{"path":"/mnt/backups","type":"Directory"},"name":"backup-storage"}]}}}},"schedule":"0 2 * * *","successfulJobsHistoryLimit":7}}
    creationTimestamp: "2025-11-08T08:24:04Z"
    generation: 2
    name: bitpin-daily-backup
    namespace: bitpin-task
    resourceVersion: "138768"
    uid: 9af36651-14dd-4791-92ea-870484630d91
  spec:
    concurrencyPolicy: Allow
    failedJobsHistoryLimit: 1
    jobTemplate:
      metadata:
        creationTimestamp: null
      spec:
        template:
          metadata:
            creationTimestamp: null
          spec:
            containers:
            - command:
              - /bin/bash
              - -c
              - "set -e\necho \"=== Starting PostgreSQL Backup ===\"\necho \"Time:
                $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/full\"\nTIMESTAMP=$(date
                +%Y%m%d-%H%M%S)\nBACKUP_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.dump\"\nCOMPRESSED_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.log\"\n\n#
                ایجاد دایرکتوری اگر وجود ندارد\nmkdir -p $BACKUP_DIR\n\necho \"Backup
                directory: $BACKUP_DIR\"\necho \"Backup file: $BACKUP_FILE\"\necho
                \"Compressed file: $COMPRESSED_FILE\"\n\n# گرفتن بکاپ و فشرده‌سازی
                مستقیم\necho \"Starting pg_dump with compression...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
                pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
                \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --verbose
                \\\n  --format=custom \\\n  2>&1 | tee $LOG_FILE | gzip > $COMPRESSED_FILE\n\n#
                بررسی موفقیت آمیز بودن بکاپ\nif [ ${PIPESTATUS[0]} -eq 0 ]; then\n
                \   echo \"✓ Backup completed successfully\"\n    COMPRESSED_SIZE=$(du
                -h \"$COMPRESSED_FILE\" | cut -f1)\n    echo \"✓ Compressed backup
                size: $COMPRESSED_SIZE\"\n    \n    # محاسبه نسبت فشرده‌سازی (اختیاری)\n
                \   echo \"✓ Backup compressed to: $COMPRESSED_FILE\"\nelse\n    echo
                \"✗ Backup failed!\"\n    exit 1\nfi\n\n# لیست بکاپ‌های موجود\necho
                \"=== Current backups ===\"\nls -la $BACKUP_DIR/*.gz 2>/dev/null ||
                echo \"No backup files found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho
                \"=== Cleaning up old backups ===\"\nfind $BACKUP_DIR -name \"*.gz\"
                -mtime +7 -delete\nfind $BACKUP_DIR -name \"*.log\" -mtime +7 -delete\n\necho
                \"✓ Cleanup completed\"\necho \"=== Backup process finished ===\"\necho
                \"Time: $(date)\"\n"
              image: postgres:15
              imagePullPolicy: IfNotPresent
              name: postgres-backup
              resources: {}
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: File
              volumeMounts:
              - mountPath: /backups
                name: backup-storage
            dnsPolicy: ClusterFirst
            nodeSelector:
              kubernetes.io/hostname: mobin-log-backup-able
            restartPolicy: OnFailure
            schedulerName: default-scheduler
            securityContext: {}
            terminationGracePeriodSeconds: 30
            volumes:
            - hostPath:
                path: /mnt/backups
                type: Directory
              name: backup-storage
    schedule: 0 2 * * *
    successfulJobsHistoryLimit: 7
    suspend: false
  status: {}
- apiVersion: batch/v1
  kind: CronJob
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"batch/v1","kind":"CronJob","metadata":{"annotations":{},"name":"bitpin-daily-backup-compressed","namespace":"bitpin-task"},"spec":{"jobTemplate":{"spec":{"template":{"spec":{"containers":[{"command":["/bin/bash","-c","set -e\necho \"=== Starting PostgreSQL Backup ===\"\necho \"Time: $(date)\"\n\nBACKUP_DIR=\"/backups/full\"\nTIMESTAMP=$(date +%Y%m%d-%H%M%S)\nBACKUP_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.log\"\n\nmkdir -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Compressed backup file: $BACKUP_FILE\"\n\n# گرفتن بکاپ و فشرده‌سازی مستقیم در یک مرحله\necho \"Starting pg_dump with gzip compression...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\" pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --verbose \\\n  --format=custom | gzip -9 \u003e $BACKUP_FILE 2\u003e $LOG_FILE\n\n# بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Backup completed successfully\"\n    BACKUP_SIZE=$(du -h \"$BACKUP_FILE\" | cut -f1)\n    echo \"✓ Compressed backup size: $BACKUP_SIZE\"\n    echo \"✓ Backup saved to: $BACKUP_FILE\"\n    \n    # نمایش اطلاعات لاگ\n    echo \"=== Backup Log ===\"\n    cat $LOG_FILE\nelse\n    echo \"✗ Backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست بکاپ‌های موجود\necho \"=== Current backups ===\"\nls -lh $BACKUP_DIR/*.gz 2\u003e/dev/null || echo \"No backup files found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old backups ===\"\nfind $BACKUP_DIR -name \"*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"*.log\" -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Backup process finished ===\"\necho \"Time: $(date)\"\n"],"image":"postgres:15","name":"postgres-backup","volumeMounts":[{"mountPath":"/backups","name":"backup-storage"}]}],"nodeSelector":{"kubernetes.io/hostname":"mobin-log-backup-able"},"restartPolicy":"OnFailure","volumes":[{"hostPath":{"path":"/mnt/backups","type":"Directory"},"name":"backup-storage"}]}}}},"schedule":"0 2 * * *","successfulJobsHistoryLimit":7}}
    creationTimestamp: "2025-11-08T08:33:21Z"
    generation: 1
    name: bitpin-daily-backup-compressed
    namespace: bitpin-task
    resourceVersion: "138457"
    uid: 279f1863-8ca6-4c49-b300-161668f34089
  spec:
    concurrencyPolicy: Allow
    failedJobsHistoryLimit: 1
    jobTemplate:
      metadata:
        creationTimestamp: null
      spec:
        template:
          metadata:
            creationTimestamp: null
          spec:
            containers:
            - command:
              - /bin/bash
              - -c
              - "set -e\necho \"=== Starting PostgreSQL Backup ===\"\necho \"Time:
                $(date)\"\n\nBACKUP_DIR=\"/backups/full\"\nTIMESTAMP=$(date +%Y%m%d-%H%M%S)\nBACKUP_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.log\"\n\nmkdir
                -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Compressed
                backup file: $BACKUP_FILE\"\n\n# گرفتن بکاپ و فشرده‌سازی مستقیم در
                یک مرحله\necho \"Starting pg_dump with gzip compression...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
                pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
                \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --verbose
                \\\n  --format=custom | gzip -9 > $BACKUP_FILE 2> $LOG_FILE\n\n# بررسی
                موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Backup
                completed successfully\"\n    BACKUP_SIZE=$(du -h \"$BACKUP_FILE\"
                | cut -f1)\n    echo \"✓ Compressed backup size: $BACKUP_SIZE\"\n
                \   echo \"✓ Backup saved to: $BACKUP_FILE\"\n    \n    # نمایش اطلاعات
                لاگ\n    echo \"=== Backup Log ===\"\n    cat $LOG_FILE\nelse\n    echo
                \"✗ Backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست
                بکاپ‌های موجود\necho \"=== Current backups ===\"\nls -lh $BACKUP_DIR/*.gz
                2>/dev/null || echo \"No backup files found\"\n\n# حذف بکاپ‌های قدیمی
                (بیش از ۷ روز)\necho \"=== Cleaning up old backups ===\"\nfind $BACKUP_DIR
                -name \"*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"*.log\"
                -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Backup
                process finished ===\"\necho \"Time: $(date)\"\n"
              image: postgres:15
              imagePullPolicy: IfNotPresent
              name: postgres-backup
              resources: {}
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: File
              volumeMounts:
              - mountPath: /backups
                name: backup-storage
            dnsPolicy: ClusterFirst
            nodeSelector:
              kubernetes.io/hostname: mobin-log-backup-able
            restartPolicy: OnFailure
            schedulerName: default-scheduler
            securityContext: {}
            terminationGracePeriodSeconds: 30
            volumes:
            - hostPath:
                path: /mnt/backups
                type: Directory
              name: backup-storage
    schedule: 0 2 * * *
    successfulJobsHistoryLimit: 7
    suspend: false
  status: {}
- apiVersion: batch/v1
  kind: CronJob
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"batch/v1","kind":"CronJob","metadata":{"annotations":{},"name":"bitpin-daily-backup-zip","namespace":"bitpin-task"},"spec":{"jobTemplate":{"spec":{"template":{"spec":{"containers":[{"command":["/bin/bash","-c","set -e\necho \"=== Starting PostgreSQL Backup ===\"\necho \"Time: $(date)\"\n\n# نصب zip اگر وجود ندارد\napt-get update \u0026\u0026 apt-get install -y zip || true\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/full\"\nTIMESTAMP=$(date +%Y%m%d-%H%M%S)\nBACKUP_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.dump\"\nZIP_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.zip\"\nLOG_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.log\"\n\nmkdir -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Backup file: $BACKUP_FILE\"\necho \"Zip file: $ZIP_FILE\"\n\n# گرفتن بکاپ\necho \"Starting pg_dump...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\" pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --verbose \\\n  --format=custom \\\n  --file=\"$BACKUP_FILE\" 2\u003e\u00261 | tee $LOG_FILE\n\n# بررسی موفقیت آمیز بودن بکاپ\nif [ ${PIPESTATUS[0]} -eq 0 ]; then\n    echo \"✓ Backup completed successfully\"\n    \n    # فشرده‌سازی با zip\n    echo \"Compressing backup with zip...\"\n    zip -j -9 \"$ZIP_FILE\" \"$BACKUP_FILE\" \"$LOG_FILE\"\n    \n    # حذف فایل اصلی\n    rm -f \"$BACKUP_FILE\"\n    \n    ZIP_SIZE=$(du -h \"$ZIP_FILE\" | cut -f1)\n    echo \"✓ Zip file size: $ZIP_SIZE\"\n    echo \"✓ Backup archived to: $ZIP_FILE\"\nelse\n    echo \"✗ Backup failed!\"\n    exit 1\nfi\n\n# لیست بکاپ‌های موجود\necho \"=== Current backups ===\"\nls -la $BACKUP_DIR/*.zip 2\u003e/dev/null || echo \"No backup files found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old backups ===\"\nfind $BACKUP_DIR -name \"*.zip\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"*.log\" -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Backup process finished ===\"\necho \"Time: $(date)\"\n"],"image":"postgres:15","name":"postgres-backup","volumeMounts":[{"mountPath":"/backups","name":"backup-storage"}]}],"nodeSelector":{"kubernetes.io/hostname":"mobin-log-backup-able"},"restartPolicy":"OnFailure","volumes":[{"hostPath":{"path":"/mnt/backups","type":"Directory"},"name":"backup-storage"}]}}}},"schedule":"0 2 * * *","successfulJobsHistoryLimit":7}}
    creationTimestamp: "2025-11-08T08:35:00Z"
    generation: 1
    name: bitpin-daily-backup-zip
    namespace: bitpin-task
    resourceVersion: "138639"
    uid: 89058ab3-c1f0-487f-b22f-b6138c56dd69
  spec:
    concurrencyPolicy: Allow
    failedJobsHistoryLimit: 1
    jobTemplate:
      metadata:
        creationTimestamp: null
      spec:
        template:
          metadata:
            creationTimestamp: null
          spec:
            containers:
            - command:
              - /bin/bash
              - -c
              - "set -e\necho \"=== Starting PostgreSQL Backup ===\"\necho \"Time:
                $(date)\"\n\n# نصب zip اگر وجود ندارد\napt-get update && apt-get install
                -y zip || true\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/full\"\nTIMESTAMP=$(date
                +%Y%m%d-%H%M%S)\nBACKUP_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.dump\"\nZIP_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.zip\"\nLOG_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.log\"\n\nmkdir
                -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Backup
                file: $BACKUP_FILE\"\necho \"Zip file: $ZIP_FILE\"\n\n# گرفتن بکاپ\necho
                \"Starting pg_dump...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
                pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
                \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --verbose
                \\\n  --format=custom \\\n  --file=\"$BACKUP_FILE\" 2>&1 | tee $LOG_FILE\n\n#
                بررسی موفقیت آمیز بودن بکاپ\nif [ ${PIPESTATUS[0]} -eq 0 ]; then\n
                \   echo \"✓ Backup completed successfully\"\n    \n    # فشرده‌سازی
                با zip\n    echo \"Compressing backup with zip...\"\n    zip -j -9
                \"$ZIP_FILE\" \"$BACKUP_FILE\" \"$LOG_FILE\"\n    \n    # حذف فایل
                اصلی\n    rm -f \"$BACKUP_FILE\"\n    \n    ZIP_SIZE=$(du -h \"$ZIP_FILE\"
                | cut -f1)\n    echo \"✓ Zip file size: $ZIP_SIZE\"\n    echo \"✓
                Backup archived to: $ZIP_FILE\"\nelse\n    echo \"✗ Backup failed!\"\n
                \   exit 1\nfi\n\n# لیست بکاپ‌های موجود\necho \"=== Current backups
                ===\"\nls -la $BACKUP_DIR/*.zip 2>/dev/null || echo \"No backup files
                found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning
                up old backups ===\"\nfind $BACKUP_DIR -name \"*.zip\" -mtime +7 -delete\nfind
                $BACKUP_DIR -name \"*.log\" -mtime +7 -delete\n\necho \"✓ Cleanup
                completed\"\necho \"=== Backup process finished ===\"\necho \"Time:
                $(date)\"\n"
              image: postgres:15
              imagePullPolicy: IfNotPresent
              name: postgres-backup
              resources: {}
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: File
              volumeMounts:
              - mountPath: /backups
                name: backup-storage
            dnsPolicy: ClusterFirst
            nodeSelector:
              kubernetes.io/hostname: mobin-log-backup-able
            restartPolicy: OnFailure
            schedulerName: default-scheduler
            securityContext: {}
            terminationGracePeriodSeconds: 30
            volumes:
            - hostPath:
                path: /mnt/backups
                type: Directory
              name: backup-storage
    schedule: 0 2 * * *
    successfulJobsHistoryLimit: 7
    suspend: false
  status: {}
- apiVersion: batch/v1
  kind: CronJob
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"batch/v1","kind":"CronJob","metadata":{"annotations":{},"name":"bitpin-full-backup","namespace":"bitpin-task"},"spec":{"concurrencyPolicy":"Forbid","failedJobsHistoryLimit":1,"jobTemplate":{"spec":{"template":{"spec":{"containers":[{"command":["/bin/bash","-c","BACKUP_DIR=/mnt/backups/full\nmkdir -p $BACKUP_DIR\n# stanza-create اگر هنوز انجام نشده\npgbackrest --stanza=bitpin --db-path=/var/lib/postgresql/data --repo1-path=$BACKUP_DIR --db-host=bitpin-cluster-rw --log-level-console=info stanza-create || true\n# گرفتن full backup\npgbackrest --stanza=bitpin --db-path=/var/lib/postgresql/data --repo1-path=$BACKUP_DIR --db-host=bitpin-cluster-rw --type=full --log-level-console=info backup\n"],"env":[{"name":"PGPASSWORD","valueFrom":{"secretKeyRef":{"key":"password","name":"bitpin-cluster-app"}}}],"image":"yasaman664/postgres-pgbackrest:15","name":"full-backup","volumeMounts":[{"mountPath":"/mnt/backups","name":"backup-storage"}]}],"restartPolicy":"OnFailure","volumes":[{"hostPath":{"path":"/mnt/bitpin/backups"},"name":"backup-storage"}]}}}},"schedule":"0 2 * * *","successfulJobsHistoryLimit":3}}
    creationTimestamp: "2025-11-07T10:19:49Z"
    generation: 7
    name: bitpin-full-backup
    namespace: bitpin-task
    resourceVersion: "134540"
    uid: 421d776f-38c1-4fa1-9f4d-8862dda30af4
  spec:
    concurrencyPolicy: Forbid
    failedJobsHistoryLimit: 1
    jobTemplate:
      metadata:
        creationTimestamp: null
      spec:
        template:
          metadata:
            creationTimestamp: null
          spec:
            containers:
            - command:
              - /bin/bash
              - -c
              - |
                BACKUP_DIR=/mnt/backups/full
                mkdir -p $BACKUP_DIR
                # stanza-create اگر هنوز انجام نشده
                pgbackrest --stanza=bitpin --db-path=/var/lib/postgresql/data --repo1-path=$BACKUP_DIR --db-host=bitpin-cluster-rw --log-level-console=info stanza-create || true
                # گرفتن full backup
                pgbackrest --stanza=bitpin --db-path=/var/lib/postgresql/data --repo1-path=$BACKUP_DIR --db-host=bitpin-cluster-rw --type=full --log-level-console=info backup
              env:
              - name: PGPASSWORD
                valueFrom:
                  secretKeyRef:
                    key: password
                    name: bitpin-cluster-app
              image: yasaman664/postgres-pgbackrest:15
              imagePullPolicy: IfNotPresent
              name: full-backup
              resources: {}
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: File
              volumeMounts:
              - mountPath: /mnt/backups
                name: backup-storage
            dnsPolicy: ClusterFirst
            restartPolicy: OnFailure
            schedulerName: default-scheduler
            securityContext: {}
            terminationGracePeriodSeconds: 30
            volumes:
            - hostPath:
                path: /mnt/bitpin/backups
                type: ""
              name: backup-storage
    schedule: 0 2 * * *
    successfulJobsHistoryLimit: 3
    suspend: false
  status:
    lastScheduleTime: "2025-11-07T22:30:00Z"
- apiVersion: batch/v1
  kind: CronJob
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"batch/v1","kind":"CronJob","metadata":{"annotations":{},"name":"bitpin-full-backup-simple","namespace":"bitpin-task"},"spec":{"concurrencyPolicy":"Allow","failedJobsHistoryLimit":1,"jobTemplate":{"spec":{"template":{"spec":{"containers":[{"command":["/bin/bash","-c","mkdir -p /mnt/backups/full\nchmod 777 /mnt/backups/full\nBACKUP_FILE=\"/mnt/backups/full/bitpin-backup-$(date +%F-%H%M%S).sql.gz\"\necho \"Starting backup...\"\npg_dump -h $DB_HOST -p $DB_PORT -U $DB_USER -d $DB_NAME | gzip \u003e \"$BACKUP_FILE\"\necho \"Backup saved to $BACKUP_FILE\"\nfind /mnt/backups/full -type f -mtime +7 -delete\n"],"env":[{"name":"PGPASSWORD","valueFrom":{"secretKeyRef":{"key":"password","name":"bitpin-cluster-app"}}},{"name":"DB_HOST","valueFrom":{"secretKeyRef":{"key":"host","name":"bitpin-cluster-app"}}},{"name":"DB_PORT","valueFrom":{"secretKeyRef":{"key":"port","name":"bitpin-cluster-app"}}},{"name":"DB_NAME","valueFrom":{"secretKeyRef":{"key":"dbname","name":"bitpin-cluster-app"}}},{"name":"DB_USER","valueFrom":{"secretKeyRef":{"key":"username","name":"bitpin-cluster-app"}}}],"image":"postgres:15","name":"full-backup","volumeMounts":[{"mountPath":"/mnt/backups","name":"backup-storage"}]}],"restartPolicy":"OnFailure","volumes":[{"hostPath":{"path":"/mnt/backups"},"name":"backup-storage"}]}}}},"schedule":"0 2 * * *","successfulJobsHistoryLimit":3}}
    creationTimestamp: "2025-11-08T07:59:01Z"
    generation: 2
    name: bitpin-full-backup-simple
    namespace: bitpin-task
    resourceVersion: "135365"
    uid: 2357cb83-4994-4d64-9543-261b0271bb4e
  spec:
    concurrencyPolicy: Allow
    failedJobsHistoryLimit: 1
    jobTemplate:
      metadata:
        creationTimestamp: null
      spec:
        template:
          metadata:
            creationTimestamp: null
          spec:
            containers:
            - command:
              - /bin/bash
              - -c
              - |
                mkdir -p /mnt/backups/full
                chmod 777 /mnt/backups/full
                BACKUP_FILE="/mnt/backups/full/bitpin-backup-$(date +%F-%H%M%S).sql.gz"
                echo "Starting backup..."
                pg_dump -h $DB_HOST -p $DB_PORT -U $DB_USER -d $DB_NAME | gzip > "$BACKUP_FILE"
                echo "Backup saved to $BACKUP_FILE"
                find /mnt/backups/full -type f -mtime +7 -delete
              env:
              - name: PGPASSWORD
                valueFrom:
                  secretKeyRef:
                    key: password
                    name: bitpin-cluster-app
              - name: DB_HOST
                valueFrom:
                  secretKeyRef:
                    key: host
                    name: bitpin-cluster-app
              - name: DB_PORT
                valueFrom:
                  secretKeyRef:
                    key: port
                    name: bitpin-cluster-app
              - name: DB_NAME
                valueFrom:
                  secretKeyRef:
                    key: dbname
                    name: bitpin-cluster-app
              - name: DB_USER
                valueFrom:
                  secretKeyRef:
                    key: username
                    name: bitpin-cluster-app
              image: postgres:15
              imagePullPolicy: IfNotPresent
              name: full-backup
              resources: {}
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: File
              volumeMounts:
              - mountPath: /mnt/backups
                name: backup-storage
            dnsPolicy: ClusterFirst
            restartPolicy: OnFailure
            schedulerName: default-scheduler
            securityContext: {}
            terminationGracePeriodSeconds: 30
            volumes:
            - hostPath:
                path: /mnt/backups
                type: ""
              name: backup-storage
    schedule: 0 2 * * *
    successfulJobsHistoryLimit: 3
    suspend: false
  status: {}
- apiVersion: batch/v1
  kind: CronJob
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"batch/v1","kind":"CronJob","metadata":{"annotations":{},"name":"bitpin-incremental-backup","namespace":"bitpin-task"},"spec":{"jobTemplate":{"spec":{"template":{"spec":{"containers":[{"command":["/bin/bash","-c","set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n# بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\" -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n    echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\" pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n      -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only \\\n      --verbose | gzip -9 \u003e $SCHEMA_BACKUP_FILE 2\u003e\u003e $LOG_FILE\n    echo \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\" pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n  --verbose \\\n  --format=custom | gzip -9 \u003e $DATA_BACKUP_FILE 2\u003e\u003e $LOG_FILE\n\n# بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\" | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\" ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n        echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz 2\u003e/dev/null | head -5 || echo \"No data backup files found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho \"Time: $(date)\"\n"],"image":"postgres:15","name":"incremental-backup","volumeMounts":[{"mountPath":"/backups","name":"backup-storage"}]}],"nodeSelector":{"kubernetes.io/hostname":"mobin-log-backup-able"},"restartPolicy":"OnFailure","volumes":[{"hostPath":{"path":"/mnt/backups","type":"Directory"},"name":"backup-storage"}]}}}},"schedule":"*/15 * * * *","successfulJobsHistoryLimit":96}}
    creationTimestamp: "2025-11-08T08:44:27Z"
    generation: 1
    name: bitpin-incremental-backup
    namespace: bitpin-task
    resourceVersion: "166260"
    uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
  spec:
    concurrencyPolicy: Allow
    failedJobsHistoryLimit: 1
    jobTemplate:
      metadata:
        creationTimestamp: null
      spec:
        template:
          metadata:
            creationTimestamp: null
          spec:
            containers:
            - command:
              - /bin/bash
              - -c
              - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
                \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
                +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
                -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
                backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
                بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if
                schema backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name
                \"schema-*.dump.gz\" -type f -exec ls -t {} + | head -1)\n\nif [ -z
                \"$LATEST_SCHEMA\" ]; then\n    echo \"Creating initial schema backup...\"\n
                \   PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
                pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local
                \\\n      -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db
                \\\n      --schema-only \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE
                2>> $LOG_FILE\n    echo \"✓ Schema backup created\"\nelse\n    echo
                \"✓ Using existing schema backup: $(basename $LATEST_SCHEMA)\"\n    #
                برای صرفه‌جویی در فضا، schema جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n#
                بکاپ داده‌ها (فقط داده‌ها)\necho \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
                pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
                \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only
                \\\n  --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE
                2>> $LOG_FILE\n\n# بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n
                \   echo \"✓ Incremental data backup completed successfully\"\n    DATA_SIZE=$(du
                -h \"$DATA_BACKUP_FILE\" | cut -f1)\n    echo \"✓ Data backup size:
                $DATA_SIZE\"\n    \n    # اگر schema هم ساخته شد، اندازه آن را هم
                نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\" ]; then\n        SCHEMA_SIZE=$(du
                -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n        echo \"✓ Schema backup
                size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo \"✗ Incremental backup
                failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n# لیست آخرین بکاپ‌ها\necho
                \"=== Latest incremental backups ===\"\nls -lt $BACKUP_DIR/data-*.gz
                2>/dev/null | head -5 || echo \"No data backup files found\"\n\n#
                حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old incremental
                backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime +7 -delete\nfind
                $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR
                -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓ Cleanup
                completed\"\necho \"=== Incremental backup process finished ===\"\necho
                \"Time: $(date)\"\n"
              image: postgres:15
              imagePullPolicy: IfNotPresent
              name: incremental-backup
              resources: {}
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: File
              volumeMounts:
              - mountPath: /backups
                name: backup-storage
            dnsPolicy: ClusterFirst
            nodeSelector:
              kubernetes.io/hostname: mobin-log-backup-able
            restartPolicy: OnFailure
            schedulerName: default-scheduler
            securityContext: {}
            terminationGracePeriodSeconds: 30
            volumes:
            - hostPath:
                path: /mnt/backups
                type: Directory
              name: backup-storage
    schedule: '*/15 * * * *'
    successfulJobsHistoryLimit: 96
    suspend: false
  status:
    lastScheduleTime: "2025-11-08T13:30:00Z"
    lastSuccessfulTime: "2025-11-08T13:30:07Z"
- apiVersion: batch/v1
  kind: CronJob
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"batch/v1","kind":"CronJob","metadata":{"annotations":{},"name":"bitpin-wal-backup","namespace":"bitpin-task"},"spec":{"jobTemplate":{"spec":{"template":{"spec":{"containers":[{"command":["/bin/bash","-c","set -e\necho \"=== Starting WAL Archive Backup ===\"\necho \"Time: $(date)\"\n\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date +%Y%m%d-%H%M%S)\nLOG_FILE=\"$BACKUP_DIR/wal-$TIMESTAMP.log\"\n\nmkdir -p $BACKUP_DIR\n\n# ایجاد WAL backup با استفاده از pg_basebackup برای PITR\necho \"Creating WAL archive backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\" pg_basebackup \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p 5432 \\\n  -U bitpin_user \\\n  -D \"$BACKUP_DIR/wal-backup-$TIMESTAMP\" \\\n  -F tar \\\n  -X stream \\\n  -P 2\u003e\u00261 | tee $LOG_FILE\n\n# فشرده‌سازی WAL backup\nif [ $? -eq 0 ]; then\n    echo \"Compressing WAL backup...\"\n    tar -czf \"$BACKUP_DIR/wal-backup-$TIMESTAMP.tar.gz\" -C \"$BACKUP_DIR\" \"wal-backup-$TIMESTAMP\"\n    rm -rf \"$BACKUP_DIR/wal-backup-$TIMESTAMP\"\n    \n    WAL_SIZE=$(du -h \"$BACKUP_DIR/wal-backup-$TIMESTAMP.tar.gz\" | cut -f1)\n    echo \"✓ WAL backup completed successfully\"\n    echo \"✓ WAL backup size: $WAL_SIZE\"\nelse\n    echo \"✗ WAL backup failed!\"\n    exit 1\nfi\n\n# حذف بکاپ‌های قدیمی\nfind $BACKUP_DIR -name \"wal-backup-*.tar.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"wal-*.log\" -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\n"],"image":"postgres:15","name":"wal-backup","volumeMounts":[{"mountPath":"/backups","name":"backup-storage"}]}],"nodeSelector":{"kubernetes.io/hostname":"mobin-log-backup-able"},"restartPolicy":"OnFailure","volumes":[{"hostPath":{"path":"/mnt/backups","type":"Directory"},"name":"backup-storage"}]}}}},"schedule":"*/15 * * * *","successfulJobsHistoryLimit":96}}
    creationTimestamp: "2025-11-08T08:45:19Z"
    generation: 1
    name: bitpin-wal-backup
    namespace: bitpin-task
    resourceVersion: "166788"
    uid: 216d8763-a2dd-4c1d-946f-497acdc1e9b1
  spec:
    concurrencyPolicy: Allow
    failedJobsHistoryLimit: 1
    jobTemplate:
      metadata:
        creationTimestamp: null
      spec:
        template:
          metadata:
            creationTimestamp: null
          spec:
            containers:
            - command:
              - /bin/bash
              - -c
              - "set -e\necho \"=== Starting WAL Archive Backup ===\"\necho \"Time:
                $(date)\"\n\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
                +%Y%m%d-%H%M%S)\nLOG_FILE=\"$BACKUP_DIR/wal-$TIMESTAMP.log\"\n\nmkdir
                -p $BACKUP_DIR\n\n# ایجاد WAL backup با استفاده از pg_basebackup برای
                PITR\necho \"Creating WAL archive backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
                pg_basebackup \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local
                \\\n  -p 5432 \\\n  -U bitpin_user \\\n  -D \"$BACKUP_DIR/wal-backup-$TIMESTAMP\"
                \\\n  -F tar \\\n  -X stream \\\n  -P 2>&1 | tee $LOG_FILE\n\n# فشرده‌سازی
                WAL backup\nif [ $? -eq 0 ]; then\n    echo \"Compressing WAL backup...\"\n
                \   tar -czf \"$BACKUP_DIR/wal-backup-$TIMESTAMP.tar.gz\" -C \"$BACKUP_DIR\"
                \"wal-backup-$TIMESTAMP\"\n    rm -rf \"$BACKUP_DIR/wal-backup-$TIMESTAMP\"\n
                \   \n    WAL_SIZE=$(du -h \"$BACKUP_DIR/wal-backup-$TIMESTAMP.tar.gz\"
                | cut -f1)\n    echo \"✓ WAL backup completed successfully\"\n    echo
                \"✓ WAL backup size: $WAL_SIZE\"\nelse\n    echo \"✗ WAL backup failed!\"\n
                \   exit 1\nfi\n\n# حذف بکاپ‌های قدیمی\nfind $BACKUP_DIR -name \"wal-backup-*.tar.gz\"
                -mtime +7 -delete\nfind $BACKUP_DIR -name \"wal-*.log\" -mtime +7
                -delete\n\necho \"✓ Cleanup completed\"\n"
              image: postgres:15
              imagePullPolicy: IfNotPresent
              name: wal-backup
              resources: {}
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: File
              volumeMounts:
              - mountPath: /backups
                name: backup-storage
            dnsPolicy: ClusterFirst
            nodeSelector:
              kubernetes.io/hostname: mobin-log-backup-able
            restartPolicy: OnFailure
            schedulerName: default-scheduler
            securityContext: {}
            terminationGracePeriodSeconds: 30
            volumes:
            - hostPath:
                path: /mnt/backups
                type: Directory
              name: backup-storage
    schedule: '*/15 * * * *'
    successfulJobsHistoryLimit: 96
    suspend: false
  status:
    lastScheduleTime: "2025-11-08T13:30:00Z"
- apiVersion: batch/v1
  kind: CronJob
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"batch/v1","kind":"CronJob","metadata":{"annotations":{},"name":"postgres-full-backup","namespace":"bitpin-task"},"spec":{"jobTemplate":{"spec":{"template":{"spec":{"containers":[{"command":["/bin/bash","-c","set -e\n\nPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"\nexport PGPASSWORD=$PASSWORD\n\nBACKUP_DIR=\"/backups/full\"\nmkdir -p $BACKUP_DIR\nBACKUP_FILE=\"$BACKUP_DIR/backup-$(date +%Y%m%d-%H%M%S).sql\"\n\necho \"Starting backup at $(date)\"\n\npg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --verbose \\\n  --format=custom \\\n  --file=\"$BACKUP_FILE\"\n\necho \"Backup completed: $BACKUP_FILE\"\necho \"Backup size: $(du -h $BACKUP_FILE | cut -f1)\"\n\n# حذف بکاپ‌های قدیمی\nfind $BACKUP_DIR -name \"*.sql\" -mtime +7 -delete\necho \"Cleanup completed\"\n"],"image":"postgres:15","name":"postgres-backup","volumeMounts":[{"mountPath":"/backups","name":"backup-volume"}]}],"restartPolicy":"OnFailure","volumes":[{"name":"backup-volume","persistentVolumeClaim":{"claimName":"backup-pvc"}}]}}}},"schedule":"0 2 * * *","successfulJobsHistoryLimit":7}}
    creationTimestamp: "2025-11-08T08:07:25Z"
    generation: 3
    name: postgres-full-backup
    namespace: bitpin-task
    resourceVersion: "136621"
    uid: c0869c22-8ed1-4b32-8061-73b70bedbb45
  spec:
    concurrencyPolicy: Allow
    failedJobsHistoryLimit: 1
    jobTemplate:
      metadata:
        creationTimestamp: null
      spec:
        template:
          metadata:
            creationTimestamp: null
          spec:
            containers:
            - command:
              - /bin/bash
              - -c
              - |
                set -e

                PASSWORD="jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s"
                export PGPASSWORD=$PASSWORD

                BACKUP_DIR="/backups/full"
                mkdir -p $BACKUP_DIR
                BACKUP_FILE="$BACKUP_DIR/backup-$(date +%Y%m%d-%H%M%S).sql"

                echo "Starting backup at $(date)"

                pg_dump \
                  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \
                  -p 5432 \
                  -U bitpin_user \
                  -d bitpin_db \
                  --verbose \
                  --format=custom \
                  --file="$BACKUP_FILE"

                echo "Backup completed: $BACKUP_FILE"
                echo "Backup size: $(du -h $BACKUP_FILE | cut -f1)"

                # حذف بکاپ‌های قدیمی
                find $BACKUP_DIR -name "*.sql" -mtime +7 -delete
                echo "Cleanup completed"
              image: postgres:15
              imagePullPolicy: IfNotPresent
              name: postgres-backup
              resources: {}
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: File
              volumeMounts:
              - mountPath: /backups
                name: backup-volume
            dnsPolicy: ClusterFirst
            restartPolicy: OnFailure
            schedulerName: default-scheduler
            securityContext: {}
            terminationGracePeriodSeconds: 30
            volumes:
            - name: backup-volume
              persistentVolumeClaim:
                claimName: backup-pvc
    schedule: 0 2 * * *
    successfulJobsHistoryLimit: 7
    suspend: false
  status: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T08:45:00Z"
    creationTimestamp: "2025-11-08T08:45:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 75a97203-98ac-427e-bef8-c0678a4cb1d3
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376525
      controller-uid: 75a97203-98ac-427e-bef8-c0678a4cb1d3
      job-name: bitpin-incremental-backup-29376525
    name: bitpin-incremental-backup-29376525
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "139567"
    uid: 75a97203-98ac-427e-bef8-c0678a4cb1d3
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: 75a97203-98ac-427e-bef8-c0678a4cb1d3
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: 75a97203-98ac-427e-bef8-c0678a4cb1d3
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376525
          controller-uid: 75a97203-98ac-427e-bef8-c0678a4cb1d3
          job-name: bitpin-incremental-backup-29376525
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T08:45:04Z"
    conditions:
    - lastProbeTime: "2025-11-08T08:45:04Z"
      lastTransitionTime: "2025-11-08T08:45:04Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T08:45:04Z"
      lastTransitionTime: "2025-11-08T08:45:04Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T08:45:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T09:00:00Z"
    creationTimestamp: "2025-11-08T09:00:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 65527515-8d2b-47a4-ba3d-1059fae86805
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376540
      controller-uid: 65527515-8d2b-47a4-ba3d-1059fae86805
      job-name: bitpin-incremental-backup-29376540
    name: bitpin-incremental-backup-29376540
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "140989"
    uid: 65527515-8d2b-47a4-ba3d-1059fae86805
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: 65527515-8d2b-47a4-ba3d-1059fae86805
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: 65527515-8d2b-47a4-ba3d-1059fae86805
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376540
          controller-uid: 65527515-8d2b-47a4-ba3d-1059fae86805
          job-name: bitpin-incremental-backup-29376540
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T09:00:12Z"
    conditions:
    - lastProbeTime: "2025-11-08T09:00:12Z"
      lastTransitionTime: "2025-11-08T09:00:12Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T09:00:12Z"
      lastTransitionTime: "2025-11-08T09:00:12Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T09:00:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T09:15:00Z"
    creationTimestamp: "2025-11-08T09:15:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 45a907f8-57f3-4bea-97f6-c3ec189aa07f
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376555
      controller-uid: 45a907f8-57f3-4bea-97f6-c3ec189aa07f
      job-name: bitpin-incremental-backup-29376555
    name: bitpin-incremental-backup-29376555
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "142364"
    uid: 45a907f8-57f3-4bea-97f6-c3ec189aa07f
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: 45a907f8-57f3-4bea-97f6-c3ec189aa07f
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: 45a907f8-57f3-4bea-97f6-c3ec189aa07f
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376555
          controller-uid: 45a907f8-57f3-4bea-97f6-c3ec189aa07f
          job-name: bitpin-incremental-backup-29376555
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T09:15:07Z"
    conditions:
    - lastProbeTime: "2025-11-08T09:15:07Z"
      lastTransitionTime: "2025-11-08T09:15:07Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T09:15:07Z"
      lastTransitionTime: "2025-11-08T09:15:07Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T09:15:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T09:30:00Z"
    creationTimestamp: "2025-11-08T09:30:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 0d8a6c73-49d4-4d3f-8ef5-e2c3ee5aa26b
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376570
      controller-uid: 0d8a6c73-49d4-4d3f-8ef5-e2c3ee5aa26b
      job-name: bitpin-incremental-backup-29376570
    name: bitpin-incremental-backup-29376570
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "143727"
    uid: 0d8a6c73-49d4-4d3f-8ef5-e2c3ee5aa26b
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: 0d8a6c73-49d4-4d3f-8ef5-e2c3ee5aa26b
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: 0d8a6c73-49d4-4d3f-8ef5-e2c3ee5aa26b
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376570
          controller-uid: 0d8a6c73-49d4-4d3f-8ef5-e2c3ee5aa26b
          job-name: bitpin-incremental-backup-29376570
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T09:30:07Z"
    conditions:
    - lastProbeTime: "2025-11-08T09:30:07Z"
      lastTransitionTime: "2025-11-08T09:30:07Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T09:30:07Z"
      lastTransitionTime: "2025-11-08T09:30:07Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T09:30:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T09:45:00Z"
    creationTimestamp: "2025-11-08T09:45:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 9b01986a-8ade-4768-b820-ef4a1d3384dc
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376585
      controller-uid: 9b01986a-8ade-4768-b820-ef4a1d3384dc
      job-name: bitpin-incremental-backup-29376585
    name: bitpin-incremental-backup-29376585
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "145095"
    uid: 9b01986a-8ade-4768-b820-ef4a1d3384dc
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: 9b01986a-8ade-4768-b820-ef4a1d3384dc
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: 9b01986a-8ade-4768-b820-ef4a1d3384dc
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376585
          controller-uid: 9b01986a-8ade-4768-b820-ef4a1d3384dc
          job-name: bitpin-incremental-backup-29376585
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T09:45:09Z"
    conditions:
    - lastProbeTime: "2025-11-08T09:45:09Z"
      lastTransitionTime: "2025-11-08T09:45:09Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T09:45:09Z"
      lastTransitionTime: "2025-11-08T09:45:09Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T09:45:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T10:00:00Z"
    creationTimestamp: "2025-11-08T10:00:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 0e92b704-4859-4127-bde7-8effe5fa8984
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376600
      controller-uid: 0e92b704-4859-4127-bde7-8effe5fa8984
      job-name: bitpin-incremental-backup-29376600
    name: bitpin-incremental-backup-29376600
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "146449"
    uid: 0e92b704-4859-4127-bde7-8effe5fa8984
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: 0e92b704-4859-4127-bde7-8effe5fa8984
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: 0e92b704-4859-4127-bde7-8effe5fa8984
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376600
          controller-uid: 0e92b704-4859-4127-bde7-8effe5fa8984
          job-name: bitpin-incremental-backup-29376600
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T10:00:08Z"
    conditions:
    - lastProbeTime: "2025-11-08T10:00:08Z"
      lastTransitionTime: "2025-11-08T10:00:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T10:00:08Z"
      lastTransitionTime: "2025-11-08T10:00:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T10:00:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T10:15:00Z"
    creationTimestamp: "2025-11-08T10:15:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 581527bc-0b06-4f29-9e3e-ff7314f4a65b
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376615
      controller-uid: 581527bc-0b06-4f29-9e3e-ff7314f4a65b
      job-name: bitpin-incremental-backup-29376615
    name: bitpin-incremental-backup-29376615
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "147802"
    uid: 581527bc-0b06-4f29-9e3e-ff7314f4a65b
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: 581527bc-0b06-4f29-9e3e-ff7314f4a65b
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: 581527bc-0b06-4f29-9e3e-ff7314f4a65b
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376615
          controller-uid: 581527bc-0b06-4f29-9e3e-ff7314f4a65b
          job-name: bitpin-incremental-backup-29376615
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T10:15:08Z"
    conditions:
    - lastProbeTime: "2025-11-08T10:15:08Z"
      lastTransitionTime: "2025-11-08T10:15:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T10:15:08Z"
      lastTransitionTime: "2025-11-08T10:15:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T10:15:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T10:30:00Z"
    creationTimestamp: "2025-11-08T10:30:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: a4841de6-b50e-40cb-bcec-8c700509dabb
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376630
      controller-uid: a4841de6-b50e-40cb-bcec-8c700509dabb
      job-name: bitpin-incremental-backup-29376630
    name: bitpin-incremental-backup-29376630
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "149133"
    uid: a4841de6-b50e-40cb-bcec-8c700509dabb
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: a4841de6-b50e-40cb-bcec-8c700509dabb
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: a4841de6-b50e-40cb-bcec-8c700509dabb
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376630
          controller-uid: a4841de6-b50e-40cb-bcec-8c700509dabb
          job-name: bitpin-incremental-backup-29376630
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T10:30:07Z"
    conditions:
    - lastProbeTime: "2025-11-08T10:30:07Z"
      lastTransitionTime: "2025-11-08T10:30:07Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T10:30:07Z"
      lastTransitionTime: "2025-11-08T10:30:07Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T10:30:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T10:45:00Z"
    creationTimestamp: "2025-11-08T10:45:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 0133646f-dd0a-4158-9219-a98c7c3ffab2
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376645
      controller-uid: 0133646f-dd0a-4158-9219-a98c7c3ffab2
      job-name: bitpin-incremental-backup-29376645
    name: bitpin-incremental-backup-29376645
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "150487"
    uid: 0133646f-dd0a-4158-9219-a98c7c3ffab2
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: 0133646f-dd0a-4158-9219-a98c7c3ffab2
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: 0133646f-dd0a-4158-9219-a98c7c3ffab2
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376645
          controller-uid: 0133646f-dd0a-4158-9219-a98c7c3ffab2
          job-name: bitpin-incremental-backup-29376645
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T10:45:08Z"
    conditions:
    - lastProbeTime: "2025-11-08T10:45:08Z"
      lastTransitionTime: "2025-11-08T10:45:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T10:45:08Z"
      lastTransitionTime: "2025-11-08T10:45:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T10:45:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T11:00:00Z"
    creationTimestamp: "2025-11-08T11:00:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 87a1ec44-e6a2-44f7-9de0-efcc746e9dcc
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376660
      controller-uid: 87a1ec44-e6a2-44f7-9de0-efcc746e9dcc
      job-name: bitpin-incremental-backup-29376660
    name: bitpin-incremental-backup-29376660
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "152252"
    uid: 87a1ec44-e6a2-44f7-9de0-efcc746e9dcc
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: 87a1ec44-e6a2-44f7-9de0-efcc746e9dcc
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: 87a1ec44-e6a2-44f7-9de0-efcc746e9dcc
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376660
          controller-uid: 87a1ec44-e6a2-44f7-9de0-efcc746e9dcc
          job-name: bitpin-incremental-backup-29376660
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T11:00:21Z"
    conditions:
    - lastProbeTime: "2025-11-08T11:00:21Z"
      lastTransitionTime: "2025-11-08T11:00:21Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T11:00:21Z"
      lastTransitionTime: "2025-11-08T11:00:21Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T11:00:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T11:15:00Z"
    creationTimestamp: "2025-11-08T11:15:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: a2b35261-8f6e-47be-b16d-d1c541baee22
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376675
      controller-uid: a2b35261-8f6e-47be-b16d-d1c541baee22
      job-name: bitpin-incremental-backup-29376675
    name: bitpin-incremental-backup-29376675
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "153919"
    uid: a2b35261-8f6e-47be-b16d-d1c541baee22
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: a2b35261-8f6e-47be-b16d-d1c541baee22
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: a2b35261-8f6e-47be-b16d-d1c541baee22
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376675
          controller-uid: a2b35261-8f6e-47be-b16d-d1c541baee22
          job-name: bitpin-incremental-backup-29376675
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T11:15:08Z"
    conditions:
    - lastProbeTime: "2025-11-08T11:15:08Z"
      lastTransitionTime: "2025-11-08T11:15:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T11:15:08Z"
      lastTransitionTime: "2025-11-08T11:15:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T11:15:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T11:30:00Z"
    creationTimestamp: "2025-11-08T11:30:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 25d403f2-3004-418f-a155-d3244f4ad078
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376690
      controller-uid: 25d403f2-3004-418f-a155-d3244f4ad078
      job-name: bitpin-incremental-backup-29376690
    name: bitpin-incremental-backup-29376690
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "155274"
    uid: 25d403f2-3004-418f-a155-d3244f4ad078
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: 25d403f2-3004-418f-a155-d3244f4ad078
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: 25d403f2-3004-418f-a155-d3244f4ad078
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376690
          controller-uid: 25d403f2-3004-418f-a155-d3244f4ad078
          job-name: bitpin-incremental-backup-29376690
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T11:30:08Z"
    conditions:
    - lastProbeTime: "2025-11-08T11:30:08Z"
      lastTransitionTime: "2025-11-08T11:30:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T11:30:08Z"
      lastTransitionTime: "2025-11-08T11:30:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T11:30:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T11:45:00Z"
    creationTimestamp: "2025-11-08T11:45:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: a44892d8-0ea2-490e-88ab-8a540b9d6bbc
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376705
      controller-uid: a44892d8-0ea2-490e-88ab-8a540b9d6bbc
      job-name: bitpin-incremental-backup-29376705
    name: bitpin-incremental-backup-29376705
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "156625"
    uid: a44892d8-0ea2-490e-88ab-8a540b9d6bbc
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: a44892d8-0ea2-490e-88ab-8a540b9d6bbc
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: a44892d8-0ea2-490e-88ab-8a540b9d6bbc
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376705
          controller-uid: a44892d8-0ea2-490e-88ab-8a540b9d6bbc
          job-name: bitpin-incremental-backup-29376705
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T11:45:08Z"
    conditions:
    - lastProbeTime: "2025-11-08T11:45:08Z"
      lastTransitionTime: "2025-11-08T11:45:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T11:45:08Z"
      lastTransitionTime: "2025-11-08T11:45:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T11:45:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T12:00:00Z"
    creationTimestamp: "2025-11-08T12:00:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: e15d858a-f7bb-4018-b4bd-f2079af8d2b8
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376720
      controller-uid: e15d858a-f7bb-4018-b4bd-f2079af8d2b8
      job-name: bitpin-incremental-backup-29376720
    name: bitpin-incremental-backup-29376720
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "157974"
    uid: e15d858a-f7bb-4018-b4bd-f2079af8d2b8
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: e15d858a-f7bb-4018-b4bd-f2079af8d2b8
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: e15d858a-f7bb-4018-b4bd-f2079af8d2b8
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376720
          controller-uid: e15d858a-f7bb-4018-b4bd-f2079af8d2b8
          job-name: bitpin-incremental-backup-29376720
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T12:00:08Z"
    conditions:
    - lastProbeTime: "2025-11-08T12:00:08Z"
      lastTransitionTime: "2025-11-08T12:00:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T12:00:08Z"
      lastTransitionTime: "2025-11-08T12:00:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T12:00:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T12:15:00Z"
    creationTimestamp: "2025-11-08T12:15:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: fee92719-45bd-4422-9d48-62779621c094
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376735
      controller-uid: fee92719-45bd-4422-9d48-62779621c094
      job-name: bitpin-incremental-backup-29376735
    name: bitpin-incremental-backup-29376735
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "159511"
    uid: fee92719-45bd-4422-9d48-62779621c094
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: fee92719-45bd-4422-9d48-62779621c094
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: fee92719-45bd-4422-9d48-62779621c094
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376735
          controller-uid: fee92719-45bd-4422-9d48-62779621c094
          job-name: bitpin-incremental-backup-29376735
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T12:15:08Z"
    conditions:
    - lastProbeTime: "2025-11-08T12:15:08Z"
      lastTransitionTime: "2025-11-08T12:15:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T12:15:08Z"
      lastTransitionTime: "2025-11-08T12:15:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T12:15:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T12:30:00Z"
    creationTimestamp: "2025-11-08T12:30:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 8ca0ba09-ae29-4613-add4-9fa26934b026
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376750
      controller-uid: 8ca0ba09-ae29-4613-add4-9fa26934b026
      job-name: bitpin-incremental-backup-29376750
    name: bitpin-incremental-backup-29376750
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "160866"
    uid: 8ca0ba09-ae29-4613-add4-9fa26934b026
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: 8ca0ba09-ae29-4613-add4-9fa26934b026
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: 8ca0ba09-ae29-4613-add4-9fa26934b026
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376750
          controller-uid: 8ca0ba09-ae29-4613-add4-9fa26934b026
          job-name: bitpin-incremental-backup-29376750
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T12:30:07Z"
    conditions:
    - lastProbeTime: "2025-11-08T12:30:07Z"
      lastTransitionTime: "2025-11-08T12:30:07Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T12:30:07Z"
      lastTransitionTime: "2025-11-08T12:30:07Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T12:30:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T12:45:00Z"
    creationTimestamp: "2025-11-08T12:45:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 784d712d-98bc-4a6e-a73a-4614d78dc228
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376765
      controller-uid: 784d712d-98bc-4a6e-a73a-4614d78dc228
      job-name: bitpin-incremental-backup-29376765
    name: bitpin-incremental-backup-29376765
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "162215"
    uid: 784d712d-98bc-4a6e-a73a-4614d78dc228
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: 784d712d-98bc-4a6e-a73a-4614d78dc228
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: 784d712d-98bc-4a6e-a73a-4614d78dc228
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376765
          controller-uid: 784d712d-98bc-4a6e-a73a-4614d78dc228
          job-name: bitpin-incremental-backup-29376765
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T12:45:07Z"
    conditions:
    - lastProbeTime: "2025-11-08T12:45:07Z"
      lastTransitionTime: "2025-11-08T12:45:07Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T12:45:07Z"
      lastTransitionTime: "2025-11-08T12:45:07Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T12:45:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T13:00:00Z"
    creationTimestamp: "2025-11-08T13:00:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: b3226042-bd38-4f27-9d1d-c70e16099ab4
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376780
      controller-uid: b3226042-bd38-4f27-9d1d-c70e16099ab4
      job-name: bitpin-incremental-backup-29376780
    name: bitpin-incremental-backup-29376780
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "163566"
    uid: b3226042-bd38-4f27-9d1d-c70e16099ab4
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: b3226042-bd38-4f27-9d1d-c70e16099ab4
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: b3226042-bd38-4f27-9d1d-c70e16099ab4
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376780
          controller-uid: b3226042-bd38-4f27-9d1d-c70e16099ab4
          job-name: bitpin-incremental-backup-29376780
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T13:00:08Z"
    conditions:
    - lastProbeTime: "2025-11-08T13:00:08Z"
      lastTransitionTime: "2025-11-08T13:00:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T13:00:08Z"
      lastTransitionTime: "2025-11-08T13:00:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T13:00:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T13:15:00Z"
    creationTimestamp: "2025-11-08T13:15:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 5f767372-53ae-4cac-8f6c-a1bd523e4cd5
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376795
      controller-uid: 5f767372-53ae-4cac-8f6c-a1bd523e4cd5
      job-name: bitpin-incremental-backup-29376795
    name: bitpin-incremental-backup-29376795
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "164914"
    uid: 5f767372-53ae-4cac-8f6c-a1bd523e4cd5
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: 5f767372-53ae-4cac-8f6c-a1bd523e4cd5
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: 5f767372-53ae-4cac-8f6c-a1bd523e4cd5
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376795
          controller-uid: 5f767372-53ae-4cac-8f6c-a1bd523e4cd5
          job-name: bitpin-incremental-backup-29376795
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T13:15:08Z"
    conditions:
    - lastProbeTime: "2025-11-08T13:15:08Z"
      lastTransitionTime: "2025-11-08T13:15:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T13:15:08Z"
      lastTransitionTime: "2025-11-08T13:15:08Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T13:15:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T13:30:00Z"
    creationTimestamp: "2025-11-08T13:30:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 36b522f0-87dd-4fdb-8d97-bf1132984684
      batch.kubernetes.io/job-name: bitpin-incremental-backup-29376810
      controller-uid: 36b522f0-87dd-4fdb-8d97-bf1132984684
      job-name: bitpin-incremental-backup-29376810
    name: bitpin-incremental-backup-29376810
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "166257"
    uid: 36b522f0-87dd-4fdb-8d97-bf1132984684
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: 36b522f0-87dd-4fdb-8d97-bf1132984684
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: 36b522f0-87dd-4fdb-8d97-bf1132984684
          batch.kubernetes.io/job-name: bitpin-incremental-backup-29376810
          controller-uid: 36b522f0-87dd-4fdb-8d97-bf1132984684
          job-name: bitpin-incremental-backup-29376810
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T13:30:07Z"
    conditions:
    - lastProbeTime: "2025-11-08T13:30:07Z"
      lastTransitionTime: "2025-11-08T13:30:07Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T13:30:07Z"
      lastTransitionTime: "2025-11-08T13:30:07Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T13:30:00Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      batch.kubernetes.io/cronjob-scheduled-timestamp: "2025-11-08T13:30:00Z"
    creationTimestamp: "2025-11-08T13:30:00Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: f06c20f2-ec3a-447b-a594-91a95b85a245
      batch.kubernetes.io/job-name: bitpin-wal-backup-29376810
      controller-uid: f06c20f2-ec3a-447b-a594-91a95b85a245
      job-name: bitpin-wal-backup-29376810
    name: bitpin-wal-backup-29376810
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      blockOwnerDeletion: true
      controller: true
      kind: CronJob
      name: bitpin-wal-backup
      uid: 216d8763-a2dd-4c1d-946f-497acdc1e9b1
    resourceVersion: "166784"
    uid: f06c20f2-ec3a-447b-a594-91a95b85a245
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: f06c20f2-ec3a-447b-a594-91a95b85a245
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: f06c20f2-ec3a-447b-a594-91a95b85a245
          batch.kubernetes.io/job-name: bitpin-wal-backup-29376810
          controller-uid: f06c20f2-ec3a-447b-a594-91a95b85a245
          job-name: bitpin-wal-backup-29376810
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting WAL Archive Backup ===\"\necho \"Time: $(date)\"\n\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nLOG_FILE=\"$BACKUP_DIR/wal-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\n# ایجاد WAL backup با استفاده از pg_basebackup برای
            PITR\necho \"Creating WAL archive backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_basebackup \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local
            \\\n  -p 5432 \\\n  -U bitpin_user \\\n  -D \"$BACKUP_DIR/wal-backup-$TIMESTAMP\"
            \\\n  -F tar \\\n  -X stream \\\n  -P 2>&1 | tee $LOG_FILE\n\n# فشرده‌سازی
            WAL backup\nif [ $? -eq 0 ]; then\n    echo \"Compressing WAL backup...\"\n
            \   tar -czf \"$BACKUP_DIR/wal-backup-$TIMESTAMP.tar.gz\" -C \"$BACKUP_DIR\"
            \"wal-backup-$TIMESTAMP\"\n    rm -rf \"$BACKUP_DIR/wal-backup-$TIMESTAMP\"\n
            \   \n    WAL_SIZE=$(du -h \"$BACKUP_DIR/wal-backup-$TIMESTAMP.tar.gz\"
            | cut -f1)\n    echo \"✓ WAL backup completed successfully\"\n    echo
            \"✓ WAL backup size: $WAL_SIZE\"\nelse\n    echo \"✗ WAL backup failed!\"\n
            \   exit 1\nfi\n\n# حذف بکاپ‌های قدیمی\nfind $BACKUP_DIR -name \"wal-backup-*.tar.gz\"
            -mtime +7 -delete\nfind $BACKUP_DIR -name \"wal-*.log\" -mtime +7 -delete\n\necho
            \"✓ Cleanup completed\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: wal-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    conditions:
    - lastProbeTime: "2025-11-08T13:35:41Z"
      lastTransitionTime: "2025-11-08T13:35:41Z"
      message: Job has reached the specified backoff limit
      reason: BackoffLimitExceeded
      status: "True"
      type: FailureTarget
    - lastProbeTime: "2025-11-08T13:35:42Z"
      lastTransitionTime: "2025-11-08T13:35:42Z"
      message: Job has reached the specified backoff limit
      reason: BackoffLimitExceeded
      status: "True"
      type: Failed
    failed: 1
    ready: 0
    startTime: "2025-11-08T13:30:00Z"
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      cronjob.kubernetes.io/instantiate: manual
    creationTimestamp: "2025-11-08T08:25:14Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: d22e0f51-6821-42f0-8142-0cb40821711f
      batch.kubernetes.io/job-name: manual-backup-20251108-115514
      controller-uid: d22e0f51-6821-42f0-8142-0cb40821711f
      job-name: manual-backup-20251108-115514
    name: manual-backup-20251108-115514
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      kind: CronJob
      name: bitpin-daily-backup
      uid: 9af36651-14dd-4791-92ea-870484630d91
    resourceVersion: "137745"
    uid: d22e0f51-6821-42f0-8142-0cb40821711f
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: d22e0f51-6821-42f0-8142-0cb40821711f
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: d22e0f51-6821-42f0-8142-0cb40821711f
          batch.kubernetes.io/job-name: manual-backup-20251108-115514
          controller-uid: d22e0f51-6821-42f0-8142-0cb40821711f
          job-name: manual-backup-20251108-115514
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - |
            set -e
            echo "=== Starting PostgreSQL Backup ==="
            echo "Time: $(date)"

            # تنظیم متغیرها
            BACKUP_DIR="/backups/full"
            BACKUP_FILE="$BACKUP_DIR/backup-$(date +%Y%m%d-%H%M%S).dump"
            LOG_FILE="$BACKUP_DIR/backup-$(date +%Y%m%d-%H%M%S).log"

            # ایجاد دایرکتوری اگر وجود ندارد
            mkdir -p $BACKUP_DIR

            echo "Backup directory: $BACKUP_DIR"
            echo "Backup file: $BACKUP_FILE"

            # گرفتن بکاپ
            echo "Starting pg_dump..."
            PGPASSWORD="jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s" pg_dump \
              -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \
              -p 5432 \
              -U bitpin_user \
              -d bitpin_db \
              --verbose \
              --format=custom \
              --compress=9 \
              --file="$BACKUP_FILE" 2>&1 | tee $LOG_FILE

            # بررسی موفقیت آمیز بودن بکاپ
            if [ ${PIPESTATUS[0]} -eq 0 ]; then
                echo "✓ Backup completed successfully"
                BACKUP_SIZE=$(du -h "$BACKUP_FILE" | cut -f1)
                echo "✓ Backup size: $BACKUP_SIZE"
            else
                echo "✗ Backup failed!"
                exit 1
            fi

            # لیست بکاپ‌های موجود
            echo "=== Current backups ==="
            ls -la $BACKUP_DIR/*.dump 2>/dev/null || echo "No backup files found"

            # حذف بکاپ‌های قدیمی (بیش از ۷ روز)
            echo "=== Cleaning up old backups ==="
            find $BACKUP_DIR -name "*.dump" -mtime +7 -delete
            find $BACKUP_DIR -name "*.log" -mtime +7 -delete

            echo "✓ Cleanup completed"
            echo "=== Backup process finished ==="
            echo "Time: $(date)"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: postgres-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T08:25:18Z"
    conditions:
    - lastProbeTime: "2025-11-08T08:25:18Z"
      lastTransitionTime: "2025-11-08T08:25:18Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T08:25:18Z"
      lastTransitionTime: "2025-11-08T08:25:18Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T08:25:14Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      cronjob.kubernetes.io/instantiate: manual
    creationTimestamp: "2025-11-08T08:33:27Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: b4b8006c-4758-417b-a865-a593b5f2b9ce
      batch.kubernetes.io/job-name: manual-backup-20251108-120327
      controller-uid: b4b8006c-4758-417b-a865-a593b5f2b9ce
      job-name: manual-backup-20251108-120327
    name: manual-backup-20251108-120327
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      kind: CronJob
      name: bitpin-daily-backup
      uid: 9af36651-14dd-4791-92ea-870484630d91
    resourceVersion: "138486"
    uid: b4b8006c-4758-417b-a865-a593b5f2b9ce
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: b4b8006c-4758-417b-a865-a593b5f2b9ce
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: b4b8006c-4758-417b-a865-a593b5f2b9ce
          batch.kubernetes.io/job-name: manual-backup-20251108-120327
          controller-uid: b4b8006c-4758-417b-a865-a593b5f2b9ce
          job-name: manual-backup-20251108-120327
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - |
            set -e
            echo "=== Starting PostgreSQL Backup ==="
            echo "Time: $(date)"

            # تنظیم متغیرها
            BACKUP_DIR="/backups/full"
            BACKUP_FILE="$BACKUP_DIR/backup-$(date +%Y%m%d-%H%M%S).dump"
            LOG_FILE="$BACKUP_DIR/backup-$(date +%Y%m%d-%H%M%S).log"

            # ایجاد دایرکتوری اگر وجود ندارد
            mkdir -p $BACKUP_DIR

            echo "Backup directory: $BACKUP_DIR"
            echo "Backup file: $BACKUP_FILE"

            # گرفتن بکاپ
            echo "Starting pg_dump..."
            PGPASSWORD="jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s" pg_dump \
              -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \
              -p 5432 \
              -U bitpin_user \
              -d bitpin_db \
              --verbose \
              --format=custom \
              --compress=9 \
              --file="$BACKUP_FILE" 2>&1 | tee $LOG_FILE

            # بررسی موفقیت آمیز بودن بکاپ
            if [ ${PIPESTATUS[0]} -eq 0 ]; then
                echo "✓ Backup completed successfully"
                BACKUP_SIZE=$(du -h "$BACKUP_FILE" | cut -f1)
                echo "✓ Backup size: $BACKUP_SIZE"
            else
                echo "✗ Backup failed!"
                exit 1
            fi

            # لیست بکاپ‌های موجود
            echo "=== Current backups ==="
            ls -la $BACKUP_DIR/*.dump 2>/dev/null || echo "No backup files found"

            # حذف بکاپ‌های قدیمی (بیش از ۷ روز)
            echo "=== Cleaning up old backups ==="
            find $BACKUP_DIR -name "*.dump" -mtime +7 -delete
            find $BACKUP_DIR -name "*.log" -mtime +7 -delete

            echo "✓ Cleanup completed"
            echo "=== Backup process finished ==="
            echo "Time: $(date)"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: postgres-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T08:33:31Z"
    conditions:
    - lastProbeTime: "2025-11-08T08:33:31Z"
      lastTransitionTime: "2025-11-08T08:33:31Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T08:33:31Z"
      lastTransitionTime: "2025-11-08T08:33:31Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T08:33:27Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      cronjob.kubernetes.io/instantiate: manual
    creationTimestamp: "2025-11-08T08:34:23Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 4a82ee90-a7fd-4413-b7f9-f0426ef51c28
      batch.kubernetes.io/job-name: manual-backup-20251108-120423
      controller-uid: 4a82ee90-a7fd-4413-b7f9-f0426ef51c28
      job-name: manual-backup-20251108-120423
    name: manual-backup-20251108-120423
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      kind: CronJob
      name: bitpin-daily-backup
      uid: 9af36651-14dd-4791-92ea-870484630d91
    resourceVersion: "138579"
    uid: 4a82ee90-a7fd-4413-b7f9-f0426ef51c28
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: 4a82ee90-a7fd-4413-b7f9-f0426ef51c28
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: 4a82ee90-a7fd-4413-b7f9-f0426ef51c28
          batch.kubernetes.io/job-name: manual-backup-20251108-120423
          controller-uid: 4a82ee90-a7fd-4413-b7f9-f0426ef51c28
          job-name: manual-backup-20251108-120423
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - |
            set -e
            echo "=== Starting PostgreSQL Backup ==="
            echo "Time: $(date)"

            # تنظیم متغیرها
            BACKUP_DIR="/backups/full"
            BACKUP_FILE="$BACKUP_DIR/backup-$(date +%Y%m%d-%H%M%S).dump"
            LOG_FILE="$BACKUP_DIR/backup-$(date +%Y%m%d-%H%M%S).log"

            # ایجاد دایرکتوری اگر وجود ندارد
            mkdir -p $BACKUP_DIR

            echo "Backup directory: $BACKUP_DIR"
            echo "Backup file: $BACKUP_FILE"

            # گرفتن بکاپ
            echo "Starting pg_dump..."
            PGPASSWORD="jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s" pg_dump \
              -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \
              -p 5432 \
              -U bitpin_user \
              -d bitpin_db \
              --verbose \
              --format=custom \
              --compress=9 \
              --file="$BACKUP_FILE" 2>&1 | tee $LOG_FILE

            # بررسی موفقیت آمیز بودن بکاپ
            if [ ${PIPESTATUS[0]} -eq 0 ]; then
                echo "✓ Backup completed successfully"
                BACKUP_SIZE=$(du -h "$BACKUP_FILE" | cut -f1)
                echo "✓ Backup size: $BACKUP_SIZE"
            else
                echo "✗ Backup failed!"
                exit 1
            fi

            # لیست بکاپ‌های موجود
            echo "=== Current backups ==="
            ls -la $BACKUP_DIR/*.dump 2>/dev/null || echo "No backup files found"

            # حذف بکاپ‌های قدیمی (بیش از ۷ روز)
            echo "=== Cleaning up old backups ==="
            find $BACKUP_DIR -name "*.dump" -mtime +7 -delete
            find $BACKUP_DIR -name "*.log" -mtime +7 -delete

            echo "✓ Cleanup completed"
            echo "=== Backup process finished ==="
            echo "Time: $(date)"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: postgres-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T08:34:27Z"
    conditions:
    - lastProbeTime: "2025-11-08T08:34:27Z"
      lastTransitionTime: "2025-11-08T08:34:27Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T08:34:27Z"
      lastTransitionTime: "2025-11-08T08:34:27Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T08:34:23Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      cronjob.kubernetes.io/instantiate: manual
    creationTimestamp: "2025-11-08T08:35:05Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 7553f292-8b3c-4ea0-b0c5-dac19c11fdfb
      batch.kubernetes.io/job-name: manual-backup-20251108-120505
      controller-uid: 7553f292-8b3c-4ea0-b0c5-dac19c11fdfb
      job-name: manual-backup-20251108-120505
    name: manual-backup-20251108-120505
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      kind: CronJob
      name: bitpin-daily-backup
      uid: 9af36651-14dd-4791-92ea-870484630d91
    resourceVersion: "138671"
    uid: 7553f292-8b3c-4ea0-b0c5-dac19c11fdfb
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: 7553f292-8b3c-4ea0-b0c5-dac19c11fdfb
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: 7553f292-8b3c-4ea0-b0c5-dac19c11fdfb
          batch.kubernetes.io/job-name: manual-backup-20251108-120505
          controller-uid: 7553f292-8b3c-4ea0-b0c5-dac19c11fdfb
          job-name: manual-backup-20251108-120505
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - |
            set -e
            echo "=== Starting PostgreSQL Backup ==="
            echo "Time: $(date)"

            # تنظیم متغیرها
            BACKUP_DIR="/backups/full"
            BACKUP_FILE="$BACKUP_DIR/backup-$(date +%Y%m%d-%H%M%S).dump"
            LOG_FILE="$BACKUP_DIR/backup-$(date +%Y%m%d-%H%M%S).log"

            # ایجاد دایرکتوری اگر وجود ندارد
            mkdir -p $BACKUP_DIR

            echo "Backup directory: $BACKUP_DIR"
            echo "Backup file: $BACKUP_FILE"

            # گرفتن بکاپ
            echo "Starting pg_dump..."
            PGPASSWORD="jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s" pg_dump \
              -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \
              -p 5432 \
              -U bitpin_user \
              -d bitpin_db \
              --verbose \
              --format=custom \
              --compress=9 \
              --file="$BACKUP_FILE" 2>&1 | tee $LOG_FILE

            # بررسی موفقیت آمیز بودن بکاپ
            if [ ${PIPESTATUS[0]} -eq 0 ]; then
                echo "✓ Backup completed successfully"
                BACKUP_SIZE=$(du -h "$BACKUP_FILE" | cut -f1)
                echo "✓ Backup size: $BACKUP_SIZE"
            else
                echo "✗ Backup failed!"
                exit 1
            fi

            # لیست بکاپ‌های موجود
            echo "=== Current backups ==="
            ls -la $BACKUP_DIR/*.dump 2>/dev/null || echo "No backup files found"

            # حذف بکاپ‌های قدیمی (بیش از ۷ روز)
            echo "=== Cleaning up old backups ==="
            find $BACKUP_DIR -name "*.dump" -mtime +7 -delete
            find $BACKUP_DIR -name "*.log" -mtime +7 -delete

            echo "✓ Cleanup completed"
            echo "=== Backup process finished ==="
            echo "Time: $(date)"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: postgres-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T08:35:09Z"
    conditions:
    - lastProbeTime: "2025-11-08T08:35:09Z"
      lastTransitionTime: "2025-11-08T08:35:09Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T08:35:09Z"
      lastTransitionTime: "2025-11-08T08:35:09Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T08:35:05Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      cronjob.kubernetes.io/instantiate: manual
    creationTimestamp: "2025-11-08T08:36:16Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 912b1c4e-e1c0-4e3d-a7b8-28d76a5913b1
      batch.kubernetes.io/job-name: manual-backup-20251108-120615
      controller-uid: 912b1c4e-e1c0-4e3d-a7b8-28d76a5913b1
      job-name: manual-backup-20251108-120615
    name: manual-backup-20251108-120615
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      kind: CronJob
      name: bitpin-daily-backup
      uid: 9af36651-14dd-4791-92ea-870484630d91
    resourceVersion: "138811"
    uid: 912b1c4e-e1c0-4e3d-a7b8-28d76a5913b1
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: 912b1c4e-e1c0-4e3d-a7b8-28d76a5913b1
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: 912b1c4e-e1c0-4e3d-a7b8-28d76a5913b1
          batch.kubernetes.io/job-name: manual-backup-20251108-120615
          controller-uid: 912b1c4e-e1c0-4e3d-a7b8-28d76a5913b1
          job-name: manual-backup-20251108-120615
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Backup ===\"\necho \"Time: $(date)\"\n\n#
            تنظیم متغیرها\nBACKUP_DIR=\"/backups/full\"\nTIMESTAMP=$(date +%Y%m%d-%H%M%S)\nBACKUP_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.dump\"\nCOMPRESSED_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/backup-$TIMESTAMP.log\"\n\n#
            ایجاد دایرکتوری اگر وجود ندارد\nmkdir -p $BACKUP_DIR\n\necho \"Backup
            directory: $BACKUP_DIR\"\necho \"Backup file: $BACKUP_FILE\"\necho \"Compressed
            file: $COMPRESSED_FILE\"\n\n# گرفتن بکاپ و فشرده‌سازی مستقیم\necho \"Starting
            pg_dump with compression...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --verbose \\\n
            \ --format=custom \\\n  2>&1 | tee $LOG_FILE | gzip > $COMPRESSED_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ ${PIPESTATUS[0]} -eq 0 ]; then\n    echo
            \"✓ Backup completed successfully\"\n    COMPRESSED_SIZE=$(du -h \"$COMPRESSED_FILE\"
            | cut -f1)\n    echo \"✓ Compressed backup size: $COMPRESSED_SIZE\"\n
            \   \n    # محاسبه نسبت فشرده‌سازی (اختیاری)\n    echo \"✓ Backup compressed
            to: $COMPRESSED_FILE\"\nelse\n    echo \"✗ Backup failed!\"\n    exit
            1\nfi\n\n# لیست بکاپ‌های موجود\necho \"=== Current backups ===\"\nls -la
            $BACKUP_DIR/*.gz 2>/dev/null || echo \"No backup files found\"\n\n# حذف
            بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up old backups ===\"\nfind
            $BACKUP_DIR -name \"*.gz\" -mtime +7 -delete\nfind $BACKUP_DIR -name \"*.log\"
            -mtime +7 -delete\n\necho \"✓ Cleanup completed\"\necho \"=== Backup process
            finished ===\"\necho \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: postgres-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T08:36:23Z"
    conditions:
    - lastProbeTime: "2025-11-08T08:36:23Z"
      lastTransitionTime: "2025-11-08T08:36:23Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T08:36:23Z"
      lastTransitionTime: "2025-11-08T08:36:23Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T08:36:16Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"batch/v1","kind":"Job","metadata":{"annotations":{},"name":"test-db-connection","namespace":"bitpin-task"},"spec":{"template":{"spec":{"containers":[{"command":["/bin/bash","-c","echo \"Testing database connection...\"\n\n# تست اتصال ساده\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\" psql \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  -c \"SELECT current_timestamp as time, current_database() as database, version();\"\n\necho \"✓ Database connection successful!\"\n\n# تست دایرکتوری بکاپ\necho \"Testing backup directory...\"\nBACKUP_DIR=\"/backups/full\"\nmkdir -p $BACKUP_DIR\ntouch \"$BACKUP_DIR/test-write-$(date +%Y%m%d-%H%M%S).txt\"\nls -la $BACKUP_DIR/\necho \"✓ Directory write test successful!\"\n"],"image":"postgres:15","name":"test-connection","volumeMounts":[{"mountPath":"/backups","name":"backup-storage"}]}],"nodeSelector":{"kubernetes.io/hostname":"mobin-log-backup-able"},"restartPolicy":"Never","volumes":[{"hostPath":{"path":"/mnt/backups","type":"Directory"},"name":"backup-storage"}]}}}}
    creationTimestamp: "2025-11-08T08:20:59Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 1c7c96b7-8f9c-4578-8451-0a02fedaee04
      batch.kubernetes.io/job-name: test-db-connection
      controller-uid: 1c7c96b7-8f9c-4578-8451-0a02fedaee04
      job-name: test-db-connection
    name: test-db-connection
    namespace: bitpin-task
    resourceVersion: "137384"
    uid: 1c7c96b7-8f9c-4578-8451-0a02fedaee04
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: 1c7c96b7-8f9c-4578-8451-0a02fedaee04
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: 1c7c96b7-8f9c-4578-8451-0a02fedaee04
          batch.kubernetes.io/job-name: test-db-connection
          controller-uid: 1c7c96b7-8f9c-4578-8451-0a02fedaee04
          job-name: test-db-connection
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - |
            echo "Testing database connection..."

            # تست اتصال ساده
            PGPASSWORD="jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s" psql \
              -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \
              -U bitpin_user \
              -d bitpin_db \
              -c "SELECT current_timestamp as time, current_database() as database, version();"

            echo "✓ Database connection successful!"

            # تست دایرکتوری بکاپ
            echo "Testing backup directory..."
            BACKUP_DIR="/backups/full"
            mkdir -p $BACKUP_DIR
            touch "$BACKUP_DIR/test-write-$(date +%Y%m%d-%H%M%S).txt"
            ls -la $BACKUP_DIR/
            echo "✓ Directory write test successful!"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: test-connection
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: Never
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T08:21:03Z"
    conditions:
    - lastProbeTime: "2025-11-08T08:21:03Z"
      lastTransitionTime: "2025-11-08T08:21:03Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T08:21:03Z"
      lastTransitionTime: "2025-11-08T08:21:03Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T08:20:59Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      cronjob.kubernetes.io/instantiate: manual
    creationTimestamp: "2025-11-08T08:48:10Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: 7cfadd21-1922-4866-8433-74f2af6afa0e
      batch.kubernetes.io/job-name: test-incremental-20251108-121810
      controller-uid: 7cfadd21-1922-4866-8433-74f2af6afa0e
      job-name: test-incremental-20251108-121810
    name: test-incremental-20251108-121810
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      kind: CronJob
      name: bitpin-incremental-backup
      uid: bc350ac8-69a0-410b-86db-ca8514bd6e32
    resourceVersion: "139873"
    uid: 7cfadd21-1922-4866-8433-74f2af6afa0e
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: 7cfadd21-1922-4866-8433-74f2af6afa0e
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: 7cfadd21-1922-4866-8433-74f2af6afa0e
          batch.kubernetes.io/job-name: test-incremental-20251108-121810
          controller-uid: 7cfadd21-1922-4866-8433-74f2af6afa0e
          job-name: test-incremental-20251108-121810
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting PostgreSQL Incremental Backup ===\"\necho
            \"Time: $(date)\"\n\n# تنظیم متغیرها\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nDATA_BACKUP_FILE=\"$BACKUP_DIR/data-$TIMESTAMP.dump.gz\"\nSCHEMA_BACKUP_FILE=\"$BACKUP_DIR/schema-$TIMESTAMP.dump.gz\"\nLOG_FILE=\"$BACKUP_DIR/incremental-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\necho \"Backup directory: $BACKUP_DIR\"\necho \"Data
            backup: $DATA_BACKUP_FILE\"\necho \"Schema backup: $SCHEMA_BACKUP_FILE\"\n\n#
            بکاپ schema (فقط یکبار در روز یا اگر تغییر کرد)\necho \"Checking if schema
            backup is needed...\"\nLATEST_SCHEMA=$(find $BACKUP_DIR -name \"schema-*.dump.gz\"
            -type f -exec ls -t {} + | head -1)\n\nif [ -z \"$LATEST_SCHEMA\" ]; then\n
            \   echo \"Creating initial schema backup...\"\n    PGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n      -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \     -p 5432 \\\n      -U bitpin_user \\\n      -d bitpin_db \\\n      --schema-only
            \\\n      --verbose | gzip -9 > $SCHEMA_BACKUP_FILE 2>> $LOG_FILE\n    echo
            \"✓ Schema backup created\"\nelse\n    echo \"✓ Using existing schema
            backup: $(basename $LATEST_SCHEMA)\"\n    # برای صرفه‌جویی در فضا، schema
            جدید نمی‌سازیم مگر اینکه لازم باشد\nfi\n\n# بکاپ داده‌ها (فقط داده‌ها)\necho
            \"Creating incremental data backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_dump \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local \\\n
            \ -p 5432 \\\n  -U bitpin_user \\\n  -d bitpin_db \\\n  --data-only \\\n
            \ --verbose \\\n  --format=custom | gzip -9 > $DATA_BACKUP_FILE 2>> $LOG_FILE\n\n#
            بررسی موفقیت آمیز بودن بکاپ\nif [ $? -eq 0 ]; then\n    echo \"✓ Incremental
            data backup completed successfully\"\n    DATA_SIZE=$(du -h \"$DATA_BACKUP_FILE\"
            | cut -f1)\n    echo \"✓ Data backup size: $DATA_SIZE\"\n    \n    # اگر
            schema هم ساخته شد، اندازه آن را هم نمایش بده\n    if [ -f \"$SCHEMA_BACKUP_FILE\"
            ]; then\n        SCHEMA_SIZE=$(du -h \"$SCHEMA_BACKUP_FILE\" | cut -f1)\n
            \       echo \"✓ Schema backup size: $SCHEMA_SIZE\"\n    fi\nelse\n    echo
            \"✗ Incremental backup failed!\"\n    cat $LOG_FILE\n    exit 1\nfi\n\n#
            لیست آخرین بکاپ‌ها\necho \"=== Latest incremental backups ===\"\nls -lt
            $BACKUP_DIR/data-*.gz 2>/dev/null | head -5 || echo \"No data backup files
            found\"\n\n# حذف بکاپ‌های قدیمی (بیش از ۷ روز)\necho \"=== Cleaning up
            old incremental backups ===\"\nfind $BACKUP_DIR -name \"data-*.gz\" -mtime
            +7 -delete\nfind $BACKUP_DIR -name \"schema-*.gz\" -mtime +7 -delete\nfind
            $BACKUP_DIR -name \"incremental-*.log\" -mtime +7 -delete\n\necho \"✓
            Cleanup completed\"\necho \"=== Incremental backup process finished ===\"\necho
            \"Time: $(date)\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: incremental-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    completionTime: "2025-11-08T08:48:18Z"
    conditions:
    - lastProbeTime: "2025-11-08T08:48:18Z"
      lastTransitionTime: "2025-11-08T08:48:18Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: SuccessCriteriaMet
    - lastProbeTime: "2025-11-08T08:48:18Z"
      lastTransitionTime: "2025-11-08T08:48:18Z"
      message: Reached expected number of succeeded pods
      reason: CompletionsReached
      status: "True"
      type: Complete
    ready: 0
    startTime: "2025-11-08T08:48:10Z"
    succeeded: 1
    terminating: 0
    uncountedTerminatedPods: {}
- apiVersion: batch/v1
  kind: Job
  metadata:
    annotations:
      cronjob.kubernetes.io/instantiate: manual
    creationTimestamp: "2025-11-08T08:48:22Z"
    generation: 1
    labels:
      batch.kubernetes.io/controller-uid: d40e07d3-5404-4db9-8999-23d30ea5cd95
      batch.kubernetes.io/job-name: test-wal-20251108-121821
      controller-uid: d40e07d3-5404-4db9-8999-23d30ea5cd95
      job-name: test-wal-20251108-121821
    name: test-wal-20251108-121821
    namespace: bitpin-task
    ownerReferences:
    - apiVersion: batch/v1
      kind: CronJob
      name: bitpin-wal-backup
      uid: 216d8763-a2dd-4c1d-946f-497acdc1e9b1
    resourceVersion: "140437"
    uid: d40e07d3-5404-4db9-8999-23d30ea5cd95
  spec:
    backoffLimit: 6
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
      matchLabels:
        batch.kubernetes.io/controller-uid: d40e07d3-5404-4db9-8999-23d30ea5cd95
    suspend: false
    template:
      metadata:
        creationTimestamp: null
        labels:
          batch.kubernetes.io/controller-uid: d40e07d3-5404-4db9-8999-23d30ea5cd95
          batch.kubernetes.io/job-name: test-wal-20251108-121821
          controller-uid: d40e07d3-5404-4db9-8999-23d30ea5cd95
          job-name: test-wal-20251108-121821
      spec:
        containers:
        - command:
          - /bin/bash
          - -c
          - "set -e\necho \"=== Starting WAL Archive Backup ===\"\necho \"Time: $(date)\"\n\nBACKUP_DIR=\"/backups/incremental\"\nTIMESTAMP=$(date
            +%Y%m%d-%H%M%S)\nLOG_FILE=\"$BACKUP_DIR/wal-$TIMESTAMP.log\"\n\nmkdir
            -p $BACKUP_DIR\n\n# ایجاد WAL backup با استفاده از pg_basebackup برای
            PITR\necho \"Creating WAL archive backup...\"\nPGPASSWORD=\"jyoUv5DqaAyqFr4UTvakX6N5DcsCsiHDRqau0YH3cXjXD9pd4FL8lnMDltnaax9s\"
            pg_basebackup \\\n  -h bitpin-cluster-rw.bitpin-task.svc.cluster.local
            \\\n  -p 5432 \\\n  -U bitpin_user \\\n  -D \"$BACKUP_DIR/wal-backup-$TIMESTAMP\"
            \\\n  -F tar \\\n  -X stream \\\n  -P 2>&1 | tee $LOG_FILE\n\n# فشرده‌سازی
            WAL backup\nif [ $? -eq 0 ]; then\n    echo \"Compressing WAL backup...\"\n
            \   tar -czf \"$BACKUP_DIR/wal-backup-$TIMESTAMP.tar.gz\" -C \"$BACKUP_DIR\"
            \"wal-backup-$TIMESTAMP\"\n    rm -rf \"$BACKUP_DIR/wal-backup-$TIMESTAMP\"\n
            \   \n    WAL_SIZE=$(du -h \"$BACKUP_DIR/wal-backup-$TIMESTAMP.tar.gz\"
            | cut -f1)\n    echo \"✓ WAL backup completed successfully\"\n    echo
            \"✓ WAL backup size: $WAL_SIZE\"\nelse\n    echo \"✗ WAL backup failed!\"\n
            \   exit 1\nfi\n\n# حذف بکاپ‌های قدیمی\nfind $BACKUP_DIR -name \"wal-backup-*.tar.gz\"
            -mtime +7 -delete\nfind $BACKUP_DIR -name \"wal-*.log\" -mtime +7 -delete\n\necho
            \"✓ Cleanup completed\"\n"
          image: postgres:15
          imagePullPolicy: IfNotPresent
          name: wal-backup
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /backups
            name: backup-storage
        dnsPolicy: ClusterFirst
        nodeSelector:
          kubernetes.io/hostname: mobin-log-backup-able
        restartPolicy: OnFailure
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - hostPath:
            path: /mnt/backups
            type: Directory
          name: backup-storage
  status:
    conditions:
    - lastProbeTime: "2025-11-08T08:54:07Z"
      lastTransitionTime: "2025-11-08T08:54:07Z"
      message: Job has reached the specified backoff limit
      reason: BackoffLimitExceeded
      status: "True"
      type: FailureTarget
    - lastProbeTime: "2025-11-08T08:54:08Z"
      lastTransitionTime: "2025-11-08T08:54:08Z"
      message: Job has reached the specified backoff limit
      reason: BackoffLimitExceeded
      status: "True"
      type: Failed
    failed: 1
    ready: 0
    startTime: "2025-11-08T08:48:22Z"
    terminating: 0
    uncountedTerminatedPods: {}
kind: List
metadata:
  resourceVersion: ""
